---
id: 1d7b2d18-3e72-45fc-a165-54cc6064e048
title: "SNMP Simple Network Management Protocol"
---

## Port Number: +161, 162+ {#94ab88f4-a504-41c4-8569-924fbcb3b1d6}

- UDP only.

## Used-For: +SNMP enables centralized monitoring and control of network devices through standardized information exchange+. {#14649798-9da3-4b7f-8ea8-58ad24e5f788}

## Overview: {#dea9afd0-033e-45a6-a7ff-3722db81df9a}

- Protocol used for managing devices on IP networks
- Commonly employed in network management systems
- Operates over UDP (mostly port 161)

### SNMP Objects: {#4dac2a59-8368-43e6-983a-abc2cd39473e}

- +Objects are+: An SNMP object is a specific parameter or attribute of a network device that can be monitored or managed using SNMP.
  - An SNMP object is like a specific piece of information about a network device that we can keep an eye on or control using SNMP.
  - [Example]{.underline}: One common SNMP object is the system uptime. It tells us how long a network device has been running without restarting. By monitoring this object, we can keep track of the device\'s stability and performance over time.

### SNMP Versions: {#936bef25-652b-49d9-8570-571480c2f57c}

- SNMP has multiple versions, including SNMPv1, SNMPv2c, and SNMPv3.

#### SNMPv1: {#691a990b-f05c-4eb4-9882-1f640e25cfa5}

- Used for network management and monitoring.
- Supports information retrieval, device configuration, and event notifications (traps).
- Lacks built-in authentication, allowing unauthorized access to read and modify data.
- Does not support encryption, making data vulnerable to interception.

#### SNMPv2: {#9175ca89-be22-466e-a23e-7034db3ce664}

- Includes versions like v2c (community-based SNMP).
  - Still in use today, the \"c\" stands for community.
- Offers similar security flaws as SNMPv1.
- Extends functionality from the no-longer-used party-based SNMP.

#### SNMPv3: {#66a14bed-3d7a-4e08-90e9-07803cab75c8}

- Enhances security significantly compared to SNMPv1 and SNMPv2.
- Introduces authentication using usernames and passwords.
- Provides data encryption via pre-shared keys.
- More complex configuration options compared to SNMPv2c.

#### SNMP UDP Ports and Communication\*: {#e3038167-776a-490a-a06d-8c45ef907c6d}

- SNMP communication takes place over UDP.
- SNMP control commands are transmitted using agents over UDP port 161.
- Clients can set values and change settings using these commands.
- Traps, unsolicited data packets, are sent from the server to the client over UDP port 162.
- Traps notify the client of specific events without explicit requests.

### Community Strings and Access: {#421cb652-fa5c-4340-890c-3a76eb047b04}

- Function as passwords for accessing SNMP information.
- SNMP community strings provide information and statistics about devices.
- Default community strings, such as \"public\" and \"private,\" are often unchanged by manufacturers.
- SNMPv1 and SNMPv2c use plaintext community strings for access control.
- Many organizations still use SNMPv2 due to complexities in transitioning to SNMPv3.
- Administrators are concerned about maintaining active services while using SNMPv2.
- Knowledge of the community string allows access to the device.
- SNMPv3 introduced encryption and authentication for more secure access.
- Determine whether requested information can be viewed.
- Lack of knowledge about information acquisition and potential misuse by attackers causes concerns.
- Data sent using community strings is not encrypted, posing a security risk.
- Community strings transmitted over the network can be intercepted and read.

### Information Revealed by SNMP: {#6a71b490-4a7d-4928-a802-d5d440e1e97f}

- SNMP provides a wealth of information about network devices.
- Process parameters can reveal credentials passed on the command line.
- Routing information, services on additional interfaces, and software versions can also be obtained through SNMP.

<!-- -->

- **Addressing and Data Transmission**:

  - SNMP objects must have unique addresses for successful data transmission.
  - Proper addressing is essential for effective network monitoring and data exchange using SNMP.

### Managment Information Base MIBs: {#356e845e-a812-4a53-a957-f2464a1807ee}

- [SNMP access relies on the Management Information Base (MIB) for compatibility across manufacturers and client-server combinations]{.underline}.
  - MIB is an independent format for storing device information.
  - MIB files are text files that list all queryable SNMP objects in a standardized tree hierarchy.
  - Each MIB file contains at least one Object Identifier (OID) with a unique address, name, type, access rights, and description of the object.
  - MIB files are written in the Abstract Syntax Notation One (ASN.1) based ASCII text format.
  - MIBs provide information on where to find specific information, its appearance, return values for the OID, and the data type used.
  - MIBs do not contain data themselves; they act as guides to locate and understand information.

### Objecy Identifiers OIDs: {#f9a17958-69fa-45fd-8d33-f8f9e01fd23d}

- [OID (Object Identifier)]{.underline}:
  - Represents a node in a hierarchical namespace.
  - Uniquely identifies each node with a sequence of numbers.
  - Determines the node\'s position in the tree.
  - Longer chains provide more specific information.
  - Many nodes only contain references to nodes below them.
  - OIDs consist of integers concatenated by dot notation.
  - Associated OIDs can be looked up in the Object Identifier Registry.
  - Object Identifier Registry provides information on MIBs associated with the OIDs.

<!-- -->

- **MIB Example with OIDs**:

  ```txt
  MIB File: ExampleMIB.txt

  Object Identifier (OID): 1.3.6.1.2.1.1.1.0
      Name: sysDescr
      Type: Octet String
      Access Rights: Read-only
      Description: A textual description of the device.

  Object Identifier (OID): 1.3.6.1.2.1.2.2.1.2
      Name: ifDescr
      Type: DisplayString
      Access Rights: Read-only
      Description: A description of each interface on the device.

  Object Identifier (OID): 1.3.6.1.2.1.2.2.1.10
      Name: ifInOctets
      Type: Counter32
      Access Rights: Read-only
      Description: The total number of octets received on each interface.
  ```

### SNMP Operations: {#0760733c-84a5-46e7-a344-5721af271e3c}

- GET
  - Retrieve information from agent
- SET
  - Modify information on agent
- GETNEXT
  - Retrieve next item in MIB
- GETBULK
  - Retrieve large amounts of data
- TRAP
  - Unsolicited alert from agent to NMS

## +Attacking+: {#abeb8fec-cfbc-457c-8ded-02b626e8901f}

To footprint SNMP, we can use tools like snmpwalk, onesixtyone, and braa. Snmpwalk queries OIDs for information. Onesixtyone brute-forces community string names, as they can be chosen by administrators. Identifying existing community strings can be time-consuming since they can be associated with any source.

### Community Strings: {#f202fc00-fd23-4709-9a47-1da0d3555061}

- Certain community strings may be bound to specific IP addresses and named after the host\'s hostname.

- Symbols can be added to these names to increase complexity.

- In large networks with numerous SNMP-managed servers, naming patterns may emerge.

- Different rules can be used to guess community string names.

- [crunch](20230518074505-crunch.org::*crunch) can be utilized to generate custom wordlists for guessing.

- E.G. In a corporate network with multiple departments and various servers managed using SNMP, the community strings follow a naming pattern based on department and server type. Let\'s consider the following naming convention:

  - Department: Marketing (MKT)
  - Server Type: Database (DB)
  - Server Number: 001, 002, 003, ...

- [Using this naming pattern, the community strings for SNMP access could be]{.underline}:

  - Marketing Database Server 001: MKT~DB001~
  - Marketing Database Server 002: MKT~DB002~
  - Marketing Database Server 003: MKT~DB003~

### [NMAP](20230504153511-nmap.org::*NMAP) Scripting Engine: {#41652d16-8b03-4b46-96d2-e949a4a09524}

- Scripts: ls /usr/share/nmap/scripts \| grep snmp

- **Basic scan**:
  - +Sometimes this outputs better results than the below command using all scripts+:
  - sudo nmap -sU -sC -sV -p161,162 \<ip\>
- **Using all SNMP scripts**:
  - sudo nmap -sU -sC -p161,162 \<ip\> --script snmp\*

_Brutforce strings first and then walk_

### Bruteforcing SNMP Community Strings Using [hydra](20230522195504-hydra.org::*hydra): {#a8910b2c-685e-489a-8118-e6a20be4b894}

- `Command`{.verbatim}: hydra -P /usr/share/wordlists/seclists/Discovery/SNMP/snmp.txt -v \<ip\> snmp
- +Example+: hydra -P /usr/share/wordlists/seclists/Discovery/SNMP/snmp.txt -v 172.16.6.5 snmp

### Bruteforcing SNMP Community Strings Using [onesixtyone](20230504121232-onesixtyone.org::*onesixtyone): {#7e8b06e1-3284-4fe2-baa5-d738ece84b3d}

- **Brutforce using seclists**:

  - `Command`{.verbatim}: onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt \<ip\>

  - +Example+: onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt 172.16.6.5

  - +Note+ ONESIXTYONE outputs it\'s found strings in simple brackets like below\_!!!

    ```shell
    10.129.24.237 [backup] Linux NIXHARD 5.4.0-90-generic #101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64
    ```

### Bruteforcing SNMP Community Strings Using [SNMPWalk](20230504121324-snmpwalk.org::*SNMPWalk): {#43f164b5-58e8-4457-8b80-c127448f4855}

- Bruteforce with [hydra](20230522195504-hydra.org::*hydra) or something first to get a valid list of strings on the host then run snmpwalk with the found strings.

- +In the below examples \"public\" & \"backup\" are just strings found in community strings lists like seclists etc. These can be changed in and out for other options.+

- **Testing both versions for public/community strings**:

  - [V2C]{.underline}:
    - `Command: snmpwalk -v2c -c \<string\> \<ip\> \>\> snmpwalkv2c.txt`
    - +Example+: snmpwalk -v2c -c public 172.16.6.5 \>\> snmpwalkv2c.txt
  - [V1]{.underline}:
    - `Command`{.verbatim}: snmpwalk -v1 -c \<string\> \<ip\> \>\> snmpwalkv1.txt
    - +Example+: snmpwalk -v1 -c backup 172.16.6.5 \>\> snmpwalkv1.txt
    - +Note+: It is best to output the files to text file and grep/manually go through them as the output can extensive.

### Enumerating SNMP OID\'s using [braa](20230518072715-braa_snmpwalk.org::*braa) {#51c0f54e-2113-44c6-9c0f-0952f7d0e73d}

Once we know a community strings by [Bruteforcing SNMP Community Strings Using hydra](20230504121151-snmp.org::\*Bruteforcing SNMP Community Strings Using hydra:), we can then use them with braa to brute-force the individual OIDs and enumerate the information behind them.

- `Command`{.verbatim}: braa \<community string\>@\<IP\>:.1.3.6.\*
- +Example+: braa public@172.16.6.5:.1.3.6.\*

### Conf File Location & Information: {#504a905c-5447-49f5-837a-0159814c4863}

The default configuration of the SNMP daemon defines the basic settings for the service, which include the IP addresses, ports, MIB, OIDs, authentication, and community strings.

- Located at (depends on the server being used):
  - cat /etc/snmp/snmpd.conf \| grep -v \"#\" \| sed -r \'/\^`\s*`{=latex}\$/d\'
    - View only uncommented lines.

#### Conf Options (+Dangerous Options+): {#4c7ec674-76ef-45be-b61e-24550a5dee42}

Option +Dangerous+ Description

---

rwuser noauth +YES+ Provides access to the full OID tree without authentication.
rwcommunity \<community string\> \<IPv4 address\> +YES+ Provides access to the full OID tree regardless of where the requests were sent from.
rwcommunity6 \<community string\> \<IPv6 address\> +YES+ Same access as with rwcommunity with the difference of using IPv6.

## Useful Tools: {#5f8c10b3-35a6-41e3-9572-687c31acae96}

- [SNMPWalk](20230504121324-snmpwalk.org::*SNMPWalk)

- [onesixtyone](20230504121232-onesixtyone.org::*onesixtyone)

- [braa](20230518072715-braa_snmpwalk.org::*braa)
