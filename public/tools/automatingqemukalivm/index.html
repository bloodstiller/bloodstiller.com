<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <meta name="generator" content="Hugo 0.140.0">

    <script src="js/custom.js"></script>
    

    

    
        
            <meta
                name="description"
                content="Bones &amp; All Cyber Security" />
        

        
            <meta
                name="keywords"
                content="hacking, AD, hack the box, HTB, security, pentesting, cybersecurity, pentester, active-directory" />
        

        
            <meta name="author" content="bloodstiller" />
        

    


    <title>
        
            Automating Kali VM Setup with QEMU |
            Hack the planet
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
            
            <link
                rel="stylesheet"
                href="/reset.min_6107201571472815285.3662e40c85350bf0bcf308b7db81c173e4b690b862d3c3cde460de5155550bf055b7ff48cddb1cf5255e55f0355196d8dec1d49434b2457842cc77ebea198f3f.css"
                integrity="sha512-NmLkDIU1C/C88wi324HBc&#43;S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/01_layout.5974c097ff194e0a64d31c28fc478cc38b6290fe28d2cc2dbf5ae52a66751db74e4e7374bc4e25f464ea679f74cd86c474a5367e05c2db34a1b9b273466691e0.css"
                integrity="sha512-WXTAl/8ZTgpk0xwo/EeMw4tikP4o0swtv1rlKmZ1HbdOTnN0vE4l9GTqZ590zYbEdKU2fgXC2zShubJzRmaR4A==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/02_style.8484c853cc558c1c2189842f955ad4be9bf66854698f03f140aef3cfc23174c78eb1ab05b915b7877afac7464e5d70d467c87c1fb3fcbe11a75d379de01e0798.css"
                integrity="sha512-hITIU8xVjBwhiYQvlVrUvpv2aFRpjwPxQK7zz8IxdMeOsasFuRW3h3r6x0ZOXXDUZ8h8H7P8vhGnXTed4B4HmA==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/03_home.6d64455a82e28b01e58f3c37541add9e36fc8ed87562dac91ff06da3f7f11b32ac1cacaa593b2ab2e01acd894659f66c249bd0a261f051038f19a8734c3e1243.css"
                integrity="sha512-bWRFWoLiiwHljzw3VBrdnjb8jth1YtrJH/Bto/fxGzKsHKyqWTsqsuAazYlGWfZsJJvQomHwUQOPGahzTD4SQw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/04_responsive.065451199c1e1cd4f86ac1c8733e3c77eaf215b4972cefff7e7929a2837f5b2cc0e0a04f99f34d58e082812d6102c8cc9b358d21db784e9c4d5e5a8c79f4bc43.css"
                integrity="sha512-BlRRGZweHNT4asHIcz48d&#43;ryFbSXLO//fnkpooN/WyzA4KBPmfNNWOCCgS1hAsjMmzWNIdt4TpxNXlqMefS8Qw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/05_markdown.9afaac6b0a75a2cd9086fb9684dfae53bd04b90e034a252e123a9822c3fa6a5c8a3f88211159b1bd0c6918d19ed7bf3e929ff12de51d06fab0eea77e2374f967.css"
                integrity="sha512-mvqsawp1os2QhvuWhN&#43;uU70EuQ4DSiUuEjqYIsP6alyKP4ghEVmxvQxpGNGe178&#43;kp/xLeUdBvqw7qd&#43;I3T5Zw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/06_image.ee39fc51345f4c74b8c491bde29d5b2053688d0cc6e937f5660e0f5e3665212473f4cb408cd1749317343308aa41ef1baca3ec3f3aff986ab3764c822790008f.css"
                integrity="sha512-7jn8UTRfTHS4xJG94p1bIFNojQzG6Tf1Zg4PXjZlISRz9MtAjNF0kxc0MwiqQe8brKPsPzr/mGqzdkyCJ5AAjw==" />
        

    


    
    

    

    

    

    


</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Automating Kali VM Setup with QEMU -
            Hack the planet
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Walkthroughs </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/editorial-box/" title="./walkthroughs/editorial-box/">
                        
                            Editorial HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/doctor-box/" title="./walkthroughs/doctor-box/">
                        
                            Doctor HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/forest-box/" title="./walkthroughs/forest-box/">
                        
                            Forest HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/driver-box/" title="./walkthroughs/driver-box/">
                        
                            Driver HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/timelapse-box/" title="./walkthroughs/timelapse-box/">
                        
                            Timelapse HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/certified-box/" title="./walkthroughs/certified-box/">
                        
                            Certified HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/aero-box/" title="./walkthroughs/aero-box/">
                        
                            Aero HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/administrator-box/" title="./walkthroughs/administrator-box/">
                        
                            Administrator HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/sauna-box/" title="./walkthroughs/sauna-box/">
                        
                            Sauna HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/active-box/" title="./walkthroughs/active-box/">
                        
                            Active HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/cicada-box/" title="./walkthroughs/cicada-box/">
                        
                            Cicada HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/authority-box/" title="./walkthroughs/authority-box/">
                        
                            Authority HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/evilcups-box/" title="./walkthroughs/evilcups-box/">
                        
                            EvilCUPS HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/resolute-box/" title="./walkthroughs/resolute-box/">
                        
                            Resolute HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/fuse-box/" title="./walkthroughs/fuse-box/">
                        
                            Fuse HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/cascade-box/" title="./walkthroughs/cascade-box/">
                        
                            Cascade HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/monteverde-box/" title="./walkthroughs/monteverde-box/">
                        
                            Monteverde HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/outdated-box/" title="./walkthroughs/outdated-box/">
                        
                            Outdated HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/scrambled-box/" title="./walkthroughs/scrambled-box/">
                        
                            Scrambled HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/escape-box/" title="./walkthroughs/escape-box/">
                        
                            Escape HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/hospital-box/" title="./walkthroughs/hospital-box/">
                        
                            Hospital HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/intelligence-box/" title="./walkthroughs/intelligence-box/">
                        
                            Intelligence HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/manager-box/" title="./walkthroughs/manager-box/">
                        
                            Manager HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/access-box/" title="./walkthroughs/access-box/">
                        
                            Access HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/remote-box/" title="./walkthroughs/remote-box/">
                        
                            Remote HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/support-box/" title="./walkthroughs/support-box/">
                        
                            Support HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/walkthroughs/return-box/" title="./walkthroughs/return-box/">
                        
                            Return HTB Walkthrough
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Articles </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingasreproasting/" title="./articles/understandingasreproasting/">
                        
                            Understanding AS-REP Roasting Attacks: A Deep Dive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingdownloadcradles/" title="./articles/understandingdownloadcradles/">
                        
                            Understanding PowerShell Download Cradles: A Deep Dive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understanding2023-28252-clfs/" title="./articles/understanding2023-28252-clfs/">
                        
                            Understanding CVE-2023-28252: Deep Dive into the CLFS Privilege Escalation Vulnerability
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingthemebleedcve-2023-38146/" title="./articles/understandingthemebleedcve-2023-38146/">
                        
                            Understanding CVE-2023-38146: Deep Dive into the ThemeBleed Vulnerability
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingcupsexploitation/" title="./articles/understandingcupsexploitation/">
                        
                            Understanding the CUPS Exploit Chain: A Deep Dive into CVE-2024-4176, CVE-2024-4175, CVE-2024-4177 and CVE-2024-4076
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/understandingnopacexploit/" title="./articles/understandingnopacexploit/">
                        
                            Understanding the NoPac Exploit: A Deep Dive into CVE-2021-42278 and CVE-2021-42287
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/seloaddriverprivilegeescalation/" title="./articles/seloaddriverprivilegeescalation/">
                        
                            Understanding SeLoadDriverPrivilege Escalation: A Deep Dive
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/azureadconnectattack/" title="./articles/azureadconnectattack/">
                        
                            Understanding Azure AD Connect Exploitation &amp; Privilege Escalation
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/shadowcredentialsattack/" title="./articles/shadowcredentialsattack/">
                        
                            Understanding the Shadow Credentials Attack Vector
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/articles/deserializationattacksexplained/" title="./articles/deserializationattacksexplained/">
                        
                            Understanding .NET Deserialization Exploits: A Deep Dive
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Tools </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/tools/ldapire/" title="./tools/ldapire/">
                        
                            LDAPire: LDAP Enumeration Tool
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/tools/automatingqemukalivm/" title="./tools/automatingqemukalivm/">
                        
                            Automating Kali VM Setup with QEMU
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/tools/bloodserver/" title="./tools/bloodserver/">
                        
                            BloodServer: A Secure File Transfer Tool for Penetration Testers
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Cheatsheets </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/cheatsheets/ldap-cheatsheet/" title="./cheatsheets/ldap-cheatsheet/">
                        
                            Attacking LDAP: Deep Dive &amp; Cheatsheet
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/cheatsheets/rpc-cheatsheet/" title="./cheatsheets/rpc-cheatsheet/">
                        
                            Attacking RPC: Deep Dive &amp; Cheat Sheet
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/love-box/" title="./love-box/">
                        
                            Love HTB Walkthrough
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/aboutme/" title="./aboutme/">
                        
                            about me
                        
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Automating Kali VM Setup with QEMU
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/bloodstiller/"
                                class="cat-btn">
                                bloodstiller
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2024.26.10"
                            >2024.26.10
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        11 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            
                <div class="tags">
                    <i
                        class="bi bi-tags"
                        title="Tags"></i>
                    
                        <a
                            href="/tags/qemu/"
                            class="tag-btn">
                            QEMU
                        </a>
                    
                        <a
                            href="/tags/automation/"
                            class="tag-btn">
                            Automation
                        </a>
                    
                        <a
                            href="/tags/kali/"
                            class="tag-btn">
                            Kali
                        </a>
                    
                        <a
                            href="/tags/bash/"
                            class="tag-btn">
                            Bash
                        </a>
                    
                        <a
                            href="/tags/tools/"
                            class="tag-btn">
                            Tools
                        </a>
                    
                </div>
            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    




<a href="http://localhost:1313/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="http://localhost:1313/tools/" class="bread-btn">
    

    
        Tools
    
</a>




    /



<a href="http://localhost:1313/tools/automatingqemukalivm/" class="bread-btn">
    

    
        
            Automating Kali VM Setup with QEMU
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#the-need-for-automation">The Need for Automation</a></li>
    <li><a href="#the-automation-process">The Automation Process</a>
      <ul>
        <li><a href="#1-dot-launching-the-vm-with-qemu">1. Launching the VM with QEMU</a></li>
        <li><a href="#2-dot-configuring-the-vm">2. Configuring the VM</a></li>
      </ul>
    </li>
    <li><a href="#benefits-and-challenges">Benefits and Challenges</a></li>
    <li><a href="#but-ansible-exists">But ansible exists?</a></li>
    <li><a href="#customizing-the-scripts-for-your-own-use">Customizing the Scripts for Your Own Use</a>
      <ul>
        <li><a href="#modifying-launch-kali-vm-dot-sh">Modifying launch_kali_vm.sh</a></li>
        <li><a href="#customizing-kali-setup-dot-sh">Customizing kali_setup.sh</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <p>As a productivity junkie, I&rsquo;ve always been drawn to automation. Recently, I decided to streamline my process of setting up Kali Linux virtual machines using QEMU. In this article, I&rsquo;ll walk you through how I&rsquo;ve automated the creation and configuration of Kali VMs, complete with my preferred dotfiles and tools.</p>
<h2 id="the-need-for-automation">The Need for Automation</h2>
<p>If you&rsquo;re like me, you probably find yourself creating new Kali VMs frequently for various projects or testing environments. The process of setting up a new VM, updating the system, installing your favorite tools, and configuring your environment can be time-consuming and repetitive. That&rsquo;s where automation comes in handy.</p>
<h2 id="the-automation-process">The Automation Process</h2>
<p><strong>My automation setup consists of two main components</strong>:</p>
<ol>
<li>A script to launch and set up the initial VM</li>
<li>A script to configure the VM with my preferred settings and tools</li>
</ol>
<p><strong>Let&rsquo;s dive into each of these components</strong>.</p>
<h3 id="1-dot-launching-the-vm-with-qemu">1. Launching the VM with QEMU</h3>
<p>The first step in our automation process is creating and launching the VM. I&rsquo;ve created a Bash script called <code>launch_kali_vm.sh</code> that handles this. Here&rsquo;s a breakdown of what it does:</p>
<ol>
<li>Sets up variables for the VM name, image location, and resource allocation</li>
<li>Creates a new directory for the VM</li>
<li>Copies a base Kali image to the new VM directory</li>
<li>Launches the VM using QEMU with specified parameters</li>
</ol>
<p>Here&rsquo;s the script:</p>


  
    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get the directory of the script</span>
</span></span><span style="display:flex;"><span>SCRIPT_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span> cd <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span> dirname <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>BASH_SOURCE[0]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> &amp;&gt; /dev/null <span style="color:#f92672">&amp;&amp;</span> pwd <span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Variables</span>
</span></span><span style="display:flex;"><span>TODAY_DATE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y-%m-%d&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>VM_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Kali-</span>$TODAY_DATE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>BASE_QCOW_IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/run/media/martin/2TB/VMS/Templates/KaliVMTemplate/kali-linux-2024.3.qcow2&#34;</span>
</span></span><span style="display:flex;"><span>PRODUCTION_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/run/media/martin/2TB/VMS/ProductionMachines&#34;</span>
</span></span><span style="display:flex;"><span>NEW_VM_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$PRODUCTION_DIR<span style="color:#e6db74">/</span>$VM_NAME<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>NEW_QCOW_IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$NEW_VM_DIR<span style="color:#e6db74">/kali-linux-2024.3.qcow2&#34;</span>
</span></span><span style="display:flex;"><span>RAM<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;8192&#34;</span>
</span></span><span style="display:flex;"><span>CORES<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>SETUP_SCRIPT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$SCRIPT_DIR<span style="color:#e6db74">/kali_setup.sh&#34;</span>
</span></span><span style="display:flex;"><span>LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$SCRIPT_DIR<span style="color:#e6db74">/</span>$VM_NAME<span style="color:#e6db74">-log.txt&#34;</span>
</span></span><span style="display:flex;"><span>SHARED_FOLDER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$NEW_VM_DIR<span style="color:#e6db74">/shared&#34;</span>
</span></span><span style="display:flex;"><span>DROPBOX_FOLDER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/martin/Dropbox&#34;</span>
</span></span><span style="display:flex;"><span>TEST_MODE<span style="color:#f92672">=</span>false
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function for logging</span>
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;[</span><span style="color:#66d9ef">$(</span>date <span style="color:#e6db74">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">] </span>$1<span style="color:#e6db74">&#34;</span> | tee -a <span style="color:#e6db74">&#34;</span>$LOG_FILE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to check file permissions</span>
</span></span><span style="display:flex;"><span>check_permissions<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -r <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;Error: No read permission for </span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -w <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;Error: No write permission for </span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parse command line arguments</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$#<span style="color:#e6db74">&#34;</span> -gt <span style="color:#ae81ff">0</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> $1 in
</span></span><span style="display:flex;"><span>        --test<span style="color:#f92672">)</span> TEST_MODE<span style="color:#f92672">=</span>true ;;
</span></span><span style="display:flex;"><span>        *<span style="color:#f92672">)</span> echo <span style="color:#e6db74">&#34;Unknown parameter passed: </span>$1<span style="color:#e6db74">&#34;</span>; exit <span style="color:#ae81ff">1</span> ;;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">esac</span>
</span></span><span style="display:flex;"><span>    shift
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start logging</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;Starting Kali VM launch script&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check permissions for BASE_QCOW_IMAGE</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ! check_permissions <span style="color:#e6db74">&#34;</span>$BASE_QCOW_IMAGE<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Exiting due to permission error&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check if the setup script exists</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -f <span style="color:#e6db74">&#34;</span>$SETUP_SCRIPT<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Error: Setup script not found at </span>$SETUP_SCRIPT<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create the new directory and shared folder</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> $TEST_MODE; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST] Would create directories: </span>$NEW_VM_DIR<span style="color:#e6db74"> and </span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    mkdir -p <span style="color:#e6db74">&#34;</span>$NEW_VM_DIR<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Created directories: </span>$NEW_VM_DIR<span style="color:#e6db74"> and </span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Copy the base image to the new directory with progress display</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;Copying base image to new directory...&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> $TEST_MODE; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST] Would run: rsync -ah --progress </span>$BASE_QCOW_IMAGE<span style="color:#e6db74"> </span>$NEW_QCOW_IMAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    rsync -ah --progress <span style="color:#e6db74">&#34;</span>$BASE_QCOW_IMAGE<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$NEW_QCOW_IMAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Finished copying base image&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Copy the setup script to the shared folder</span>
</span></span><span style="display:flex;"><span>cp <span style="color:#e6db74">&#34;</span>$SETUP_SCRIPT<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$SHARED_FOLDER<span style="color:#e6db74">/&#34;</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;Copied setup script to shared folder: </span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Launch the VM using virt-install</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> $TEST_MODE; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST] Would launch VM with name: </span>$VM_NAME<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST] VM configuration:&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST]   RAM: </span>$RAM<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST]   CPUs: </span>$CORES<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST]   Disk: </span>$NEW_QCOW_IMAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST]   Shared Folder: </span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;[TEST]   Dropbox Folder: </span>$DROPBOX_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Launching VM with name: </span>$VM_NAME<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    sudo virt-install <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --name <span style="color:#e6db74">&#34;</span>$VM_NAME<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --memory $RAM <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --vcpus $CORES <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --disk path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$NEW_QCOW_IMAGE<span style="color:#e6db74">&#34;</span>,format<span style="color:#f92672">=</span>qcow2,bus<span style="color:#f92672">=</span>virtio <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --import <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --os-variant debian12 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --network network<span style="color:#f92672">=</span>default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --graphics spice <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --noautoconsole <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --filesystem source<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>,target<span style="color:#f92672">=</span>host_share,mode<span style="color:#f92672">=</span>mapped
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;VM launched successfully&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;Kali VM launch process completed&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Kali VM launched with name </span>$VM_NAME<span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;The setup script has been copied to the shared folder: </span>$SHARED_FOLDER<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;To access the shared folder in the VM:&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;1. Connect to the VM using virt-manager&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;2. Open a terminal in the VM&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;3. Run the following commands:&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;   sudo mkdir /mnt/host_share&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;   sudo mount -t 9p -o trans=virtio host_share /mnt/host_share&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;4. The setup script will be available at /mnt/host_share/kali_setup.sh&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;5. To run the setup script:&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;   sudo /mnt/host_share/kali_setup.sh&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;6. To access your Dropbox folder, use SSHFS or another file sharing method after the VM is running.&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;7. Remember to mount the 100GB disk to /mnt/100gb&#34;</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Use virt-manager to connect to the VM.&#34;</span>
</span></span></code></pre></div>
  


<p>This script automates the process of creating a new VM instance, ensuring that each new VM has a unique name based on the current date.</p>
<p>The script creates a log file in the same directory, named <code>Kali-YYYY-MM-DD-log.txt</code>, which contains details about the VM creation process.</p>
<ul>
<li>+Test Mode+: I have created a test mode where you can just print out to the screen so if you are customizing this script use it.
<ul>
<li>For test mode (no actual VM creation):
<ul>
<li><code>./launch_kali_vm.sh --test</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-dot-configuring-the-vm">2. Configuring the VM</h3>
<p>Once the VM is launched, we need to configure it with our preferred settings and tools. For this, I use another Bash script called <code>kali_setup.sh</code>. This script is copied to a shared folder that&rsquo;s accessible from within the VM. Here&rsquo;s what it does:</p>
<ol>
<li>Updates the system</li>
<li>Installs necessary packages</li>
<li>Sets up my preferred shell environment (Zsh with Oh My Zsh)</li>
<li>Installs and configures Doom Emacs</li>
<li>Clones and sets up my dotfiles</li>
<li>Configures Docker</li>
<li>Sets up mount points for shared folders</li>
</ol>
<p>Here&rsquo;s the script:</p>


  
    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kali_setup.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set up logging</span>
</span></span><span style="display:flex;"><span>SCRIPT_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cd <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>dirname <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>BASH_SOURCE[0]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$HOME<span style="color:#e6db74">/Desktop/kali_setup_log.txt&#34;</span>
</span></span><span style="display:flex;"><span>DRY_RUN<span style="color:#f92672">=</span>false
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Colors for terminal output</span>
</span></span><span style="display:flex;"><span>GREEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[0;32m&#39;</span>
</span></span><span style="display:flex;"><span>YELLOW<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[1;33m&#39;</span>
</span></span><span style="display:flex;"><span>RED<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[0;31m&#39;</span>
</span></span><span style="display:flex;"><span>NC<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\033[0m&#39;</span> <span style="color:#75715e"># No Color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function for logging</span>
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    local level<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    local message<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$2<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    local color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> $level in
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;INFO&#34;</span><span style="color:#f92672">)</span> color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$GREEN<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;WARN&#34;</span><span style="color:#f92672">)</span> color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$YELLOW<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ERROR&#34;</span><span style="color:#f92672">)</span> color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$RED<span style="color:#e6db74">&#34;</span> ;;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">esac</span>
</span></span><span style="display:flex;"><span>    echo -e <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>color<span style="color:#e6db74">}</span><span style="color:#e6db74">[</span><span style="color:#66d9ef">$(</span>date <span style="color:#e6db74">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">] [</span>$level<span style="color:#e6db74">] </span>$message<span style="color:#e6db74">${</span>NC<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> | tee -a <span style="color:#e6db74">&#34;</span>$LOG_FILE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Array to store errors</span>
</span></span><span style="display:flex;"><span>errors<span style="color:#f92672">=()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to execute or simulate command</span>
</span></span><span style="display:flex;"><span>execute<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$DRY_RUN<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> true <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;[DRY RUN] Would execute: </span>$*<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Executing: </span>$*<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        eval <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit_status<span style="color:#f92672">=</span>$?
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $exit_status -ne <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            error_msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Command failed with exit status </span>$exit_status<span style="color:#e6db74">: </span>$*<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            log <span style="color:#e6db74">&#34;ERROR&#34;</span> <span style="color:#e6db74">&#34;</span>$error_msg<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            errors<span style="color:#f92672">+=(</span><span style="color:#e6db74">&#34;</span>$error_msg<span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to execute or simulate command with automatic yes</span>
</span></span><span style="display:flex;"><span>execute_auto_yes<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$DRY_RUN<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> true <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;[DRY RUN] Would execute: yes | </span>$*<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Executing with auto yes: </span>$*<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        yes | eval <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit_status<span style="color:#f92672">=</span>$?
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $exit_status -ne <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            error_msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Command failed with exit status </span>$exit_status<span style="color:#e6db74">: yes | </span>$*<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            log <span style="color:#e6db74">&#34;ERROR&#34;</span> <span style="color:#e6db74">&#34;</span>$error_msg<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            errors<span style="color:#f92672">+=(</span><span style="color:#e6db74">&#34;</span>$error_msg<span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parse command line arguments</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$#<span style="color:#e6db74">&#34;</span> -gt <span style="color:#ae81ff">0</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> $1 in
</span></span><span style="display:flex;"><span>    --dry-run<span style="color:#f92672">)</span> DRY_RUN<span style="color:#f92672">=</span>true ;;
</span></span><span style="display:flex;"><span>    *<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Unknown parameter passed: </span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        ;;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">esac</span>
</span></span><span style="display:flex;"><span>    shift
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Starting Kali setup script&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update the system</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== System Update ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo apt update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install packages</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Package Installation ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo apt install -y <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    emacs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    eza <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    alacritty <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    git <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    bat <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    seclists
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Install docker</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Docker-ce Installation ===&#34;</span>
</span></span><span style="display:flex;"><span>execute echo <span style="color:#e6db74">&#34;deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian bookworm stable&#34;</span> |
</span></span><span style="display:flex;"><span>    sudo tee /etc/apt/sources.list.d/docker.list
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import gpg</span>
</span></span><span style="display:flex;"><span>execute curl -fsSL https://download.docker.com/linux/debian/gpg |
</span></span><span style="display:flex;"><span>    sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span><span style="display:flex;"><span>execute sudo apt update
</span></span><span style="display:flex;"><span>execute sudo apt install -y docker-ce docker-ce-cli containerd.io
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Starship</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Installing Starship ===&#34;</span>
</span></span><span style="display:flex;"><span>execute_auto_yes curl -sS https://starship.rs/install.sh | sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install oh-my-zsh</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Installing oh-my-zsh ===&#34;</span>
</span></span><span style="display:flex;"><span>execute_auto_yes sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install zsh plugins</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Installing zsh plugins ===&#34;</span>
</span></span><span style="display:flex;"><span>execute git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
</span></span><span style="display:flex;"><span>execute git clone https://github.com/zsh-users/zsh-autosuggestions ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions
</span></span><span style="display:flex;"><span>execute git clone https://github.com/zdharma-continuum/fast-syntax-highlighting.git ~/.oh-my-zsh/custom/plugins/fast-syntax-highlighting
</span></span><span style="display:flex;"><span>execute git clone --depth <span style="color:#ae81ff">1</span> -- https://github.com/marlonrichert/zsh-autocomplete.git ~/.oh-my-zsh/plugins/zsh-autocomplete
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install tmuxinator</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Installing tmuxinator ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo gem install tmuxinator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install doom emacs</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Installing Doom Emacs ===&#34;</span>
</span></span><span style="display:flex;"><span>execute git clone --depth <span style="color:#ae81ff">1</span> https://github.com/doomemacs/doomemacs ~/.emacs.d
</span></span><span style="display:flex;"><span>execute_auto_yes ~/.emacs.d/bin/doom install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Clone dotfiles repo</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Cloning dotfiles repository ===&#34;</span>
</span></span><span style="display:flex;"><span>execute git clone https://github.com/bloodstiller/kaliconfigs.git ~/.dotfiles
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setup dotfiles</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Setting up dotfiles ===&#34;</span>
</span></span><span style="display:flex;"><span>execute mkdir -p ~/.doom.d
</span></span><span style="display:flex;"><span>execute rm -rf ~/.zshrc ~/.doom.d/* ~/.config/starship.toml ~/.config/alacritty.yml
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Zsh/.zshrc ~/.zshrc
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Doom/config.el ~/.doom.d/config.el
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Doom/init.el ~/.doom.d/init.el
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Doom/packages.el ~/.doom.d/packages.el
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Doom/README.org ~/.doom.d/README.org
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Starship/starship.toml ~/.config/starship.toml
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Alacritty ~/.config/Alacritty
</span></span><span style="display:flex;"><span>execute ln -s ~/.dotfiles/Tmux/.tmux.conf ~/.tmux.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Installing Docker Enable docker</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Enabling Docker ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo systemctl enable docker --now
</span></span><span style="display:flex;"><span>execute sudo usermod -aG docker $USER
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Build doom packages</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Building Doom Emacs packages ===&#34;</span>
</span></span><span style="display:flex;"><span>execute ~/.emacs.d/bin/doom sync
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setup mount points and directories</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Setting up mount points and directories ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo mkdir -p /mnt/100gb
</span></span><span style="display:flex;"><span>execute mkdir -p ~/Dropbox
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mount shared folders &amp; drive</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Mounting shared folders and drives ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo mount -t ext4 UUID<span style="color:#f92672">=</span>89edac1a-7171-4421-87a6-696050f30325 /mnt/100gb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update fstab</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Updating fstab ===&#34;</span>
</span></span><span style="display:flex;"><span>execute echo <span style="color:#e6db74">&#34;host_share /home/kali/host_share 9p trans=virtio,_netdev 0 0&#34;</span> | sudo tee -a /etc/fstab
</span></span><span style="display:flex;"><span>execute echo <span style="color:#e6db74">&#34;UUID=89edac1a-7171-4421-87a6-696050f30325	/mnt/100gb	ext4	defaults	0	2&#34;</span> | sudo tee -a /etc/fstab
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Dropbox</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Installing Dropbox ===&#34;</span>
</span></span><span style="display:flex;"><span>execute wget https://www.dropbox.com/download?dl<span style="color:#f92672">=</span>packages/ubuntu/dropbox_2024.04.17_amd64.deb -O $HOME/Desktop/dropbox_2024.04.17_amd64.deb
</span></span><span style="display:flex;"><span>execute sudo dpkg -i $HOME/Desktop/dropbox_2024.04.17_amd64.deb
</span></span><span style="display:flex;"><span>execute sudo apt --fix-broken install -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Symlink Dropbox and Wordlists</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Setting up Dropbox and Wordlists symlinks ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo ln -s /mnt/100gb/Dropbox/Dropbox $HOME/Dropbox
</span></span><span style="display:flex;"><span>execute sudo ln -s /usr/share/wordlists ~/wordlists
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Clean up</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Cleaning up ===&#34;</span>
</span></span><span style="display:flex;"><span>execute sudo apt autoremove -y
</span></span><span style="display:flex;"><span>execute sudo apt clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;=== Setup Finished ===&#34;</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Setup complete!&#34;</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Finish setup of Dropbox in GUI&#34;</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Remember to logout &amp; back in for docker user to be enabled&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">${#</span>errors[@]<span style="color:#e6db74">}</span> -ne <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;WARN&#34;</span> <span style="color:#e6db74">&#34;The following errors occurred during setup:&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> error in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>errors[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        log <span style="color:#e6db74">&#34;WARN&#34;</span> <span style="color:#e6db74">&#34;  - </span>$error<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;INFO&#34;</span> <span style="color:#e6db74">&#34;Setup completed successfully with no errors.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div>
  


<p>This script ensures that the VM is configured with my preferred settings/dotfiles and tools, making it ready for use in no time.</p>
<ul>
<li>
<p>+Test Mode+: I have created a dry-run mode where you can just print out to the screen so if you are customizing this script use it.</p>
<ul>
<li>For dry run mode:
<ul>
<li><code>./kali_setup.sh --dry-run</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>+Note+: There a <code>execute sudo apt --fix-broken install -y</code> line as for some reason debian will not install dropbox straight away so it&rsquo;s easier to run the <code>.deb</code> and then fix.</p>
</li>
</ul>
<h2 id="benefits-and-challenges">Benefits and Challenges</h2>
<p>This automation setup has several benefits:</p>
<ol>
<li>Saves a significant amount of time on VM setup</li>
<li>Ensures consistency across all my Kali VMs</li>
<li>Makes it easy to update and modify my setup process</li>
</ol>
<p>However, it wasn&rsquo;t without its challenges. Some issues I encountered and solved include:</p>
<ul>
<li>Ensuring proper permissions for shared folders</li>
<li>Handling network configuration differences between host systems</li>
<li>Dealing with package installation errors due to repository changes</li>
</ul>
<h2 id="but-ansible-exists">But ansible exists?</h2>
<p>&ldquo;But bloodstiller why did you not use Ansible?&rdquo; Well I wanted to be in a position where if I did not have access to Ansible, I could still automate the process. I will port this process to ansible soon. However I like being able to pull a kali qmemu image from online, my script, update a few variables and then I have my setup the way I like it.</p>
<h2 id="customizing-the-scripts-for-your-own-use">Customizing the Scripts for Your Own Use</h2>
<p>While these scripts are tailored to my specific setup, they can easily be modified to suit your own needs. Here are some key areas you might want to customize:</p>
<h3 id="modifying-launch-kali-vm-dot-sh">Modifying launch_kali_vm.sh</h3>
<ol>
<li>
<p><strong>VM Specifications</strong>: Adjust the RAM, CPU cores, and disk size to match your system&rsquo;s capabilities:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20RAM=%228192%22%20%20#%20Change%20this%20to%20your%20preferred%20RAM%20size%20in%20MB%0a%20%20%20CORES=6%20%20%20%20%20#%20Adjust%20the%20number%20of%20CPU%20cores">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   RAM<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;8192&#34;</span>  <span style="color:#75715e"># Change this to your preferred RAM size in MB</span>
</span></span><span style="display:flex;"><span>   CORES<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>     <span style="color:#75715e"># Adjust the number of CPU cores</span></span></span></code></pre></div>
    
</div>
</li>
<li>
<p><strong>File Paths</strong>: Update the paths to match your system&rsquo;s directory structure:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20#%20Change%20this%20to%20the%20path%20to%20your%20base%20Kali%20image%0a%20%20%20BASE_QCOW_IMAGE=%22/path/to/your/base/kali-image.qcow2%22%0a%20%20%20#%20Change%20this%20to%20the%20path%20to%20your%20VM%20directory%0a%20%20%20PRODUCTION_DIR=%22/path/to/your/vm/directory%22">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   <span style="color:#75715e"># Change this to the path to your base Kali image</span>
</span></span><span style="display:flex;"><span>   BASE_QCOW_IMAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/your/base/kali-image.qcow2&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># Change this to the path to your VM directory</span>
</span></span><span style="display:flex;"><span>   PRODUCTION_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/your/vm/directory&#34;</span></span></span></code></pre></div>
    
</div>
</li>
<li>
<p><strong>Shared Folders</strong>: Modify the shared folder locations as needed:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20SHARED_FOLDER=%22$NEW_VM_DIR/shared%22">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   SHARED_FOLDER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$NEW_VM_DIR<span style="color:#e6db74">/shared&#34;</span></span></span></code></pre></div>
    
</div>
</li>
</ol>
<h3 id="customizing-kali-setup-dot-sh">Customizing kali_setup.sh</h3>
<ol>
<li>
<p><strong>Package Installation</strong>: Add or remove packages based on your needs:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20execute%20sudo%20apt%20install%20-y%20%5c%0a%20%20%20%20%20%20%20emacs%20%5c%0a%20%20%20%20%20%20%20eza%20%5c%0a%20%20%20%20%20%20%20alacritty%20%5c%0a%20%20%20%20%20%20%20git%20%5c%0a%20%20%20%20%20%20%20bat%20%5c%0a%20%20%20%20%20%20%20seclists%20%5c%0a%20%20%20%20%20%20%20#%20Add%20your%20preferred%20packages%20here">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   execute sudo apt install -y <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       emacs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       eza <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       alacritty <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       git <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       bat <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       seclists <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>       <span style="color:#75715e"># Add your preferred packages here</span></span></span></code></pre></div>
    
</div>
</li>
<li>
<p><strong>Dotfiles</strong>: Replace my dotfiles repository with your own:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   execute git clone https://github.com/yourusername/your-dotfiles.git ~/.dotfiles</span></span></code></pre></div>
    
</div>
</li>
<li>
<p><strong>Additional Tools</strong>: Add installation commands for any other tools you use regularly:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   <span style="color:#75715e"># Example: Installing a custom tool</span>
</span></span><span style="display:flex;"><span>   execute wget https://example.com/custom-tool.tar.gz
</span></span><span style="display:flex;"><span>   execute tar -xzvf custom-tool.tar.gz
</span></span><span style="display:flex;"><span>   execute cd custom-tool <span style="color:#f92672">&amp;&amp;</span> ./install.sh</span></span></code></pre></div>
    
</div>
</li>
<li>
<p><strong>Mount Points</strong>: Adjust the mount points and shared directories to match your setup:</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20execute%20sudo%20mkdir%20-p%20/mnt/your-custom-mount%0a%20%20%20execute%20sudo%20mount%20-t%20ext4%20UUID=your-uuid%20/mnt/your-custom-mount">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>   execute sudo mkdir -p /mnt/your-custom-mount
</span></span><span style="display:flex;"><span>   execute sudo mount -t ext4 UUID<span style="color:#f92672">=</span>your-uuid /mnt/your-custom-mount</span></span></code></pre></div>
    
</div>
</li>
</ol>
<p>Remember to test the modifications thoroughly to ensure they work as expected in your environment (+the scripts have a testing mode+)</p>
<p>By customizing these scripts, you can create a personalized, automated VM setup process that perfectly fits your workflow and toolset.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Automating the setup of Kali VMs has been a game-changer for my workflow. It allows me to quickly spin up consistent, fully-configured environments. It&rsquo;s a system that&rsquo;s efficient,easily maintainable and adaptable.</p>
<p>You can easily fork the <a href="https://github.com/bloodstiller/VMLaunchTemplates">VMLaunchTemplates repository</a>, modify the scripts to suit your needs, and iterate on the process. Before you know it, you&rsquo;ll have a customized setup that saves you time and headaches.</p>
<p>Happy hacking!</p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved .</li>
            

            
                <li>Bloodstiller</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/bloodstiller" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        2168
                    
                </li>
            


            
                <li>en</li>
            

            

            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Oct 26 2024 00:00:00
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    






















    
        
        <script
            type="text/javascript"
            src="/_theme/js/codeblock_copy.c59588ba3a219dafab515508b0bcd2d0592dc9e0e08de20dc1983bfd8cb69d03d37c78eadd81ee7bef724570f9e4286d9ea1c53ca59d3711c0bcad9e9134d0e9.js"
            integrity="sha512-xZWIujohna&#43;rUVUIsLzS0FktyeDgjeINwZg7/Yy2nQPTfHjq3YHue&#43;9yRXD55ChtnqHFPKWdNxHAvK2ekTTQ6Q=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/custom.e55ae031ca7d8c1e9bde9a72058dd382e3de5ff9b7df41d6d0e4ccb82ff9962e74b4865412dc15db16e5f16012d5cf9e2330b9826a3a36d5a272077f70e1341b.js"
            integrity="sha512-5VrgMcp9jB6b3ppyBY3TguPeX/m330HW0OTMuC/5li50tIZUEtwV2xbl8WAS1c&#43;eIzC5gmo6NtWicgd/cOE0Gw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/dir_toggle.e6f8c63f3ed9aefa9cedb3be3d5ab67e00bc3cf87a8dd7ef1ed55d642e9a7d80837636a26ae77f967f2aa74a44ae70c4134e25abca587f048c60807ba9e9c82f.js"
            integrity="sha512-5vjGPz7Zrvqc7bO&#43;PVq2fgC8PPh6jdfvHtVdZC6afYCDdjaiaud/ln8qp0pErnDEE04lq8pYfwSMYIB7qenILw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/sidebar.01b59c615736643387108a100de70c51d5e98477bdc338244a87d37f7e38286b48683459eade68087f0688f0235e7a48691e633954fa930d41823e9ddf797085.js"
            integrity="sha512-AbWcYVc2ZDOHEIoQDecMUdXphHe9wzgkSofTf344KGtIaDRZ6t5oCH8GiPAjXnpIaR5jOVT6kw1Bgj6d33lwhQ=="></script>
    















<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
